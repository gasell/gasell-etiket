<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gasell Pro - Profesyonel Sevkiyat Etiket Sistemi</title>
    
    <!--
    ╔═══════════════════════════════════════════════════════════════════════════════╗
    ║              GASELL PRO - SEVKİYAT ETİKET SİSTEMİ v7.0                        ║
    ║                                                                               ║
    ║  TİCİMAX KURULUM TALİMATLARI:                                                ║
    ║  ─────────────────────────────                                               ║
    ║  1. Bu dosyayı sunucunuza yükleyin:                                          ║
    ║     - FTP: /files/gasell-etiket-programi.html                                ║
    ║     - Veya: /assets/gasell-etiket-programi.html                              ║
    ║                                                                               ║
    ║  2. İçerik sayfanızda iframe ile gösterin:                                   ║
    ║     <iframe src="/files/gasell-etiket-programi.html"                         ║
    ║             style="width:100%; height:850px; border:none;">                  ║
    ║     </iframe>                                                                 ║
    ║                                                                               ║
    ║  © 2024 Gasell Ofis Mobilyaları - shop.gasell.com                            ║
    ╚═══════════════════════════════════════════════════════════════════════════════╝
    -->
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Profesyonel sevkiyat etiket oluşturma sistemi. ISO 780 standartlarına uygun, çoklu dil destekli.">
    <meta name="theme-color" content="#BE1622">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Gasell Pro">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkdhc2VsbCBQcm8gLSBTZXZraXlhdCBFdGlrZXQgU2lzdGVtaSIsCiAgInNob3J0X25hbWUiOiAiR2FzZWxsIFBybyIsCiAgImRlc2NyaXB0aW9uIjogIlByb2Zlc3lvbmVsIHNldmtpeWF0IGV0aWtldCBvbHXFn3R1cm1hIHNpc3RlbWkiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2Y4ZjlmYyIsCiAgInRoZW1lX2NvbG9yIjogIiNCRTE2MjIiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSFpwWlhkQ2IzZzlJakFnTUNBeE9USWdNVGt5SWo0OGNtVmpkQ0IzYVdSMGFEMGlNVGt5SWlCb1pXbG5hSFE5SWpFNU1pSWdjbmc5SWpNeUlpQm1hV3hzUFNJalFrVXhOakl5SWk4K1BIUmxlSFFnZUQwaU9UWWlJSGs5SWpFd09DSWdabTl1ZEMxbVlXMXBiSGs5SWsxdmJuUnpaWEp5WVhRaUlHWnZiblF0YzJsNlpUMGlOREFpSUdacGJHdzlJbmRvYVhSbElpQjBaWGgwTFdGdVkyaHZjajBpYldsa1pHeGxJajVIVUR3dmRHVjRkRDQ4TDNOMlp6ND0iLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        /* ═══════════════════════════════════════════════════════════════
           CSS CUSTOM PROPERTIES - THEME SYSTEM
        ═══════════════════════════════════════════════════════════════ */
        :root {
            /* Theme Colors */
            --theme-color: #BE1622;
            --theme-color-rgb: 190, 22, 34;
            --theme-light: #fff0f0;
            --theme-dark: #8a1018;
            
            /* UI Colors - Light Mode */
            --bg-primary: #f8f9fc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f0f2f5;
            --text-primary: #1a1a1a;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --border-color: #e5e7eb;
            --border-hover: #d1d5db;
            --shadow-color: rgba(0, 0, 0, 0.08);
            
            /* Status Colors */
            --color-success: #10b981;
            --color-error: #ef4444;
            --color-warning: #f59e0b;
            --color-info: #3b82f6;
            
            /* Print Colors */
            --print-black: #000000;
            --print-border: #1a1a1a;
            
            /* Spacing */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            
            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 400ms ease;
        }
        
        /* Dark Mode */
        [data-theme="dark"] {
            --bg-primary: #0f1117;
            --bg-secondary: #1a1d26;
            --bg-tertiary: #252a36;
            --text-primary: #f3f4f6;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --border-color: #374151;
            --border-hover: #4b5563;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        /* ═══════════════════════════════════════════════════════════════
           RESET & BASE STYLES
        ═══════════════════════════════════════════════════════════════ */
        @page { size: A4 portrait; margin: 0; }
        
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html {
            scroll-behavior: smooth;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        body {
            font-family: 'Montserrat', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
            transition: background var(--transition-normal), color var(--transition-normal);
        }
        
        /* Selection */
        ::selection {
            background: var(--theme-color);
            color: white;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-tertiary); }
        ::-webkit-scrollbar-thumb { 
            background: var(--border-hover); 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

        /* ═══════════════════════════════════════════════════════════════
           LAYOUT
        ═══════════════════════════════════════════════════════════════ */
        .app-wrapper {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .app-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 24px;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(12px);
        }
        
        .header-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .header-logo {
            height: 28px;
        }
        
        .header-version {
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .shortcuts-hint {
            display: none;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-right: 16px;
        }
        
        @media (min-width: 768px) {
            .shortcuts-hint { display: flex; }
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
            flex: 1;
        }
        
        @media (min-width: 1024px) {
            .app-container {
                grid-template-columns: 380px 1fr;
            }
        }
        
        .sidebar {
            position: sticky;
            top: 100px;
            height: fit-content;
        }
        
        @media (max-width: 1023px) {
            .sidebar {
                position: static;
            }
        }
        
        /* ═══════════════════════════════════════════════════════════════
           MOBİL UYUMLULUK
        ═══════════════════════════════════════════════════════════════ */
        @media (max-width: 768px) {
            .app-header {
                padding: 12px 16px;
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .logo-section img {
                height: 28px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .btn-group {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .content-area {
                flex-direction: column;
                padding: 12px;
                gap: 16px;
            }
            
            .sidebar {
                width: 100%;
                position: static;
            }
            
            .card {
                padding: 16px;
                margin-bottom: 16px;
            }
            
            .card-title {
                font-size: 0.65rem;
            }
            
            .address-fields .form-input,
            .address-fields .form-textarea {
                font-size: 16px !important; /* iOS zoom engelle */
                padding: 12px;
            }
            
            .address-row {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .color-picker {
                gap: 8px;
            }
            
            .color-option {
                width: 28px;
                height: 28px;
            }
            
            .icon-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .product-card {
                padding: 12px;
            }
            
            .product-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .product-name-input {
                font-size: 14px;
            }
            
            .parts-editor {
                grid-template-columns: 1fr;
            }
            
            .main-actions {
                flex-direction: column;
            }
            
            .main-actions .btn {
                width: 100%;
                justify-content: center;
            }
            
            .stats-bar {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .preview-container {
                padding: 12px;
            }
            
            .modal-content {
                margin: 16px;
                max-height: 90vh;
            }
            
            .auto-code-preview {
                font-size: 0.85rem;
                padding: 10px 12px;
            }
        }
        
        @media (max-width: 480px) {
            .app-header {
                padding: 10px 12px;
            }
            
            .logo-section img {
                height: 24px;
            }
            
            .version-badge {
                font-size: 8px;
                padding: 2px 6px;
            }
            
            .shortcuts-hint {
                display: none;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .btn i {
                font-size: 14px;
            }
            
            .card {
                padding: 12px;
                border-radius: 12px;
            }
            
            .address-section {
                padding: 10px;
            }
            
            .section-title {
                font-size: 0.8rem;
            }
            
            .icon-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
            }
            
            .icon-toggle {
                padding: 8px;
                font-size: 10px;
            }
            
            .icon-toggle svg {
                width: 20px;
                height: 20px;
            }
        }
        
        .main-content {
            min-width: 0;
        }

        /* ═══════════════════════════════════════════════════════════════
           CARD COMPONENT
        ═══════════════════════════════════════════════════════════════ */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 24px var(--shadow-color);
            transition: all var(--transition-normal);
        }
        
        .card:hover {
            box-shadow: 0 8px 32px var(--shadow-color);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .card-title {
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }
        
        .card-title i {
            margin-right: 8px;
        }

        /* ═══════════════════════════════════════════════════════════════
           FORM ELEMENTS
        ═══════════════════════════════════════════════════════════════ */
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .form-input,
        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            font-family: inherit;
            font-size: 0.9rem;
            color: var(--text-primary);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            outline: none;
        }
        
        .form-input:hover,
        .form-textarea:hover {
            border-color: var(--border-hover);
        }
        
        .form-input:focus,
        .form-textarea:focus {
            background: var(--bg-secondary);
            border-color: var(--theme-color);
            box-shadow: 0 0 0 3px rgba(var(--theme-color-rgb), 0.15);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .form-input.mono,
        .form-textarea.mono {
            font-family: 'JetBrains Mono', monospace;
        }
        
        .form-input.text-center {
            text-align: center;
        }
        
        .form-input.font-bold,
        .form-textarea.font-bold {
            font-weight: 700;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        /* Address Section Styles */
        .address-section {
            margin-bottom: 16px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }
        
        .address-section .section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            font-size: 0.85rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .address-section .section-title i {
            color: var(--theme-color);
        }
        
        .address-fields {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .address-fields .form-input,
        .address-fields .form-textarea {
            font-size: 0.85rem;
            padding: 10px 12px;
        }
        
        .address-fields .form-textarea {
            resize: vertical;
            min-height: 50px;
        }
        
        .receiver-section {
            border-color: var(--theme-color);
            border-width: 2px;
            background: linear-gradient(135deg, var(--theme-light) 0%, var(--bg-tertiary) 100%);
        }
        
        .receiver-highlight {
            font-weight: 700;
            color: var(--theme-color) !important;
            border-color: var(--theme-color) !important;
        }
        
        .receiver-highlight::placeholder {
            color: var(--theme-color);
            opacity: 0.5;
        }
        
        .address-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .auto-code-preview {
            background: var(--bg-tertiary);
            border: 2px dashed var(--theme-color);
            border-radius: var(--radius-md);
            padding: 12px 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            font-weight: 700;
            color: var(--theme-color);
            text-align: center;
            letter-spacing: 1px;
        }
        
        .auto-code-preview .code-placeholder {
            color: var(--text-muted);
            font-weight: 400;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.85rem;
        }
        
        /* Sabit Gönderen Stili */
        .sender-fixed .sender-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .sender-fixed .sender-header .section-title {
            margin: 0;
        }
        
        .sender-info-card {
            background: linear-gradient(135deg, var(--theme-light) 0%, var(--bg-tertiary) 100%);
            border: 2px solid var(--theme-color);
            border-radius: var(--radius-md);
            padding: 16px;
        }
        
        .sender-info-card .sender-company {
            font-size: 1rem;
            font-weight: 800;
            color: var(--theme-color);
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }
        
        .sender-info-card .sender-details {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.75rem;
        }
        
        /* Desi Hesaplama Aracı */
        .desi-calculator {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 12px;
            margin-top: 8px;
        }
        
        .desi-calculator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .desi-calculator-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .desi-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .desi-input-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .desi-input-group label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        .desi-input-group input {
            padding: 8px;
            font-size: 0.85rem;
            font-family: 'JetBrains Mono', monospace;
            text-align: center;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
        
        .desi-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: var(--theme-light);
            border: 2px solid var(--theme-color);
            border-radius: var(--radius-md);
        }
        
        .desi-result-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .desi-result-value {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--theme-color);
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Zoom Önizleme Modal */
        .zoom-modal-content {
            max-width: 95vw;
            max-height: 95vh;
            width: auto;
            padding: 0;
            overflow: hidden;
            background: #f5f5f5;
        }
        
        .zoom-container {
            width: 100%;
            height: 80vh;
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            background: linear-gradient(45deg, #e0e0e0 25%, transparent 25%), 
                        linear-gradient(-45deg, #e0e0e0 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #e0e0e0 75%), 
                        linear-gradient(-45deg, transparent 75%, #e0e0e0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            background-color: #f0f0f0;
        }
        
        .zoom-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
        }
        
        .zoom-label-wrapper {
            transform-origin: top center;
            transition: transform 0.2s ease;
            image-rendering: high-quality;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .zoom-label-wrapper .page-sheet {
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        /* ═══════════════════════════════════════════════════════════════
           COLOR PICKER
        ═══════════════════════════════════════════════════════════════ */
        .color-picker {
            display: flex;
            gap: 12px;
            justify-content: center;
            padding: 8px 0;
        }
        
        .color-option {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all var(--transition-fast);
            position: relative;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.active {
            border-color: var(--text-primary);
            transform: scale(1.15);
        }
        
        .color-option.active::after {
            content: '✓';
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        /* ═══════════════════════════════════════════════════════════════
           CHECKBOX BUTTONS
        ═══════════════════════════════════════════════════════════════ */
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        @media (min-width: 400px) {
            .checkbox-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .checkbox-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-secondary);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            user-select: none;
        }
        
        .checkbox-btn:hover {
            border-color: var(--border-hover);
            background: var(--bg-secondary);
        }
        
        .checkbox-btn.active {
            background: var(--theme-light);
            border-color: var(--theme-color);
            color: var(--theme-color);
        }
        
        .checkbox-btn i {
            font-size: 1em;
            width: 16px;
            text-align: center;
            flex-shrink: 0;
        }
        
        .barcode-toggle {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }
        
        .barcode-buttons {
            display: flex;
            gap: 8px;
        }
        
        .barcode-buttons .btn {
            flex: 1;
        }
        
        .barcode-buttons .btn.active {
            background: var(--theme-color);
            color: white;
            border-color: var(--theme-color);
        }

        /* ═══════════════════════════════════════════════════════════════
           BUTTONS
        ═══════════════════════════════════════════════════════════════ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 600;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
            white-space: nowrap;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: var(--theme-color);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: var(--theme-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(var(--theme-color-rgb), 0.3);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: var(--bg-secondary);
            border-color: var(--border-hover);
        }
        
        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
            padding: 8px;
        }
        
        .btn-ghost:hover {
            background: var(--bg-tertiary);
            color: var(--theme-color);
        }
        
        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            border-radius: 50%;
        }
        
        .btn-lg {
            padding: 16px 28px;
            font-size: 0.95rem;
        }
        
        .btn-block {
            width: 100%;
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .action-buttons-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        /* ═══════════════════════════════════════════════════════════════
           PRODUCT LIST HEADER
        ═══════════════════════════════════════════════════════════════ */
        .list-header {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
        }
        
        .list-header-info h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .list-header-info p {
            font-size: 0.875rem;
            color: var(--text-muted);
        }
        
        .list-header-actions {
            display: flex;
            gap: 8px;
        }

        /* ═══════════════════════════════════════════════════════════════
           PRODUCT ROWS
        ═══════════════════════════════════════════════════════════════ */
        .product-list {
            min-height: 100px;
        }
        
        .product-row {
            display: grid;
            grid-template-columns: 40px 1fr auto auto;
            gap: 16px;
            align-items: start;
            padding: 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            margin-bottom: 12px;
            transition: all var(--transition-fast);
            cursor: grab;
        }
        
        .product-row:hover {
            border-color: var(--border-hover);
            box-shadow: 0 4px 16px var(--shadow-color);
        }
        
        .product-row.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        
        .product-row.ghost {
            opacity: 0.4;
            border: 2px dashed var(--theme-color);
        }
        
        .row-handle {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 1.1rem;
            cursor: grab;
            padding-top: 8px;
        }
        
        .row-handle:active {
            cursor: grabbing;
        }
        
        .product-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .product-name-input {
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .parts-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 4px;
        }
        
        .part-input {
            padding: 8px 12px;
            font-size: 0.8rem;
            font-family: inherit;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            min-width: 100px;
            max-width: 140px;
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }
        
        .part-input:focus {
            background: var(--bg-secondary);
            border-color: var(--theme-color);
            outline: none;
        }
        
        .package-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }
        
        .package-label {
            font-size: 0.65rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        .counter-box {
            display: flex;
            align-items: center;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }
        
        .counter-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            color: var(--text-secondary);
            transition: all var(--transition-fast);
        }
        
        .counter-btn:hover {
            background: var(--bg-secondary);
            color: var(--theme-color);
        }
        
        .counter-val {
            padding: 0 12px;
            font-weight: 700;
            font-size: 0.9rem;
            min-width: 40px;
            text-align: center;
        }
        
        .row-actions {
            padding-top: 6px;
        }
        
        .delete-btn {
            color: var(--color-error);
        }
        
        .delete-btn:hover {
            background: #fef2f2;
        }
        
        [data-theme="dark"] .delete-btn:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        /* ═══════════════════════════════════════════════════════════════
           STATS BAR
        ═══════════════════════════════════════════════════════════════ */
        .stats-bar {
            display: flex;
            gap: 16px;
            padding: 16px 20px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stat-item.stat-highlight {
            padding: 8px 12px;
            background: var(--theme-light);
            border-radius: var(--radius-sm);
            border: 1px solid var(--theme-color);
        }
        
        .stat-item.stat-highlight .stat-value {
            color: var(--theme-color);
        }
        
        .stat-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            color: var(--theme-color);
        }
        
        .stat-item.stat-highlight .stat-icon {
            background: var(--theme-color);
            color: white;
        }
        
        .stat-info {
            display: flex;
            flex-direction: column;
        }
        
        .stat-value {
            font-size: 1.25rem;
            font-weight: 800;
            color: var(--text-primary);
            line-height: 1;
        }
        
        .stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ═══════════════════════════════════════════════════════════════
           EMPTY STATE
        ═══════════════════════════════════════════════════════════════ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-lg);
            color: var(--text-muted);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .empty-state p {
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        
        .hidden {
            display: none !important;
        }

        /* ═══════════════════════════════════════════════════════════════
           MODAL
        ═══════════════════════════════════════════════════════════════ */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: 28px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9) translateY(20px);
            transition: all var(--transition-normal);
        }
        
        .modal.modal-sm {
            max-width: 400px;
        }
        
        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
        }
        
        .modal-hint {
            background: rgba(59, 130, 246, 0.1);
            color: var(--color-info);
            padding: 16px;
            border-radius: var(--radius-md);
            margin-bottom: 16px;
            font-size: 0.875rem;
        }
        
        [data-theme="dark"] .modal-hint {
            background: rgba(59, 130, 246, 0.15);
        }
        
        .modal-hint-title {
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .modal-hint code {
            display: block;
            background: rgba(255, 255, 255, 0.5);
            padding: 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-family: 'JetBrains Mono', monospace;
        }
        
        [data-theme="dark"] .modal-hint code {
            background: rgba(0, 0, 0, 0.2);
        }
        
        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .modal-actions .btn {
            flex: 1;
        }
        
        .help-section {
            margin-bottom: 24px;
        }
        
        .help-section:last-child {
            margin-bottom: 0;
        }
        
        .help-section h3 {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 12px;
        }
        
        .help-shortcuts {
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 0.875rem;
        }
        
        .help-shortcut-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .help-features {
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.8;
        }

        /* ═══════════════════════════════════════════════════════════════
           TOAST NOTIFICATIONS
        ═══════════════════════════════════════════════════════════════ */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .toast {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background: var(--bg-secondary);
            border-left: 4px solid var(--theme-color);
            border-radius: var(--radius-md);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            min-width: 280px;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
        }
        
        .toast.success { border-color: var(--color-success); }
        .toast.success i { color: var(--color-success); }
        .toast.error { border-color: var(--color-error); }
        .toast.error i { color: var(--color-error); }
        .toast.warning { border-color: var(--color-warning); }
        .toast.warning i { color: var(--color-warning); }
        .toast.info { border-color: var(--color-info); }
        .toast.info i { color: var(--color-info); }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            to { opacity: 0; transform: translateX(50px); }
        }

        /* ═══════════════════════════════════════════════════════════════
           KEYBOARD SHORTCUTS HINT
        ═══════════════════════════════════════════════════════════════ */
        .kbd {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 2px 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-shadow: 0 1px 0 var(--border-color);
        }

        /* ═══════════════════════════════════════════════════════════════
           DROPDOWN
        ═══════════════════════════════════════════════════════════════ */
        .dropdown {
            position: relative;
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            min-width: 220px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            box-shadow: 0 8px 32px var(--shadow-color);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all var(--transition-fast);
        }
        
        .dropdown.active .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            font-size: 0.85rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: background var(--transition-fast);
        }
        
        .dropdown-item:hover {
            background: var(--bg-tertiary);
        }
        
        .dropdown-item:first-child {
            border-radius: var(--radius-md) var(--radius-md) 0 0;
        }
        
        .dropdown-item:last-child {
            border-radius: 0 0 var(--radius-md) var(--radius-md);
        }
        
        .dropdown-item .template-name {
            flex: 1;
        }
        
        .dropdown-item .delete-template {
            color: var(--color-error);
            opacity: 0.6;
            padding: 4px;
        }
        
        .dropdown-item .delete-template:hover {
            opacity: 1;
        }
        
        .dropdown-divider {
            height: 1px;
            background: var(--border-color);
            margin: 4px 0;
        }
        
        .dropdown-empty {
            padding: 12px 16px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        .dropdown-btn-text {
            display: none;
        }
        
        @media (min-width: 640px) {
            .dropdown-btn-text { display: inline; }
        }
        
        /* Language Selector */
        .lang-selector {
            display: flex;
            gap: 4px;
            background: var(--bg-tertiary);
            padding: 4px;
            border-radius: var(--radius-sm);
        }
        
        .lang-btn {
            width: 32px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: all var(--transition-fast);
            opacity: 0.5;
        }
        
        .lang-btn:hover {
            opacity: 0.8;
            background: var(--bg-secondary);
        }
        
        .lang-btn.active {
            opacity: 1;
            background: var(--bg-secondary);
            box-shadow: 0 1px 3px var(--shadow-color);
        }

        /* ═══════════════════════════════════════════════════════════════
           PREVIEW
        ═══════════════════════════════════════════════════════════════ */
        .preview-container {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        .preview-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 12px 0;
        }
        
        .preview-toggle i.chevron {
            transition: transform var(--transition-normal);
        }
        
        .preview-toggle i.chevron.rotated {
            transform: rotate(180deg);
        }
        
        .preview-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height var(--transition-slow);
        }
        
        .preview-content.active {
            max-height: 3000px;
        }
        
        .preview-scroll {
            max-height: 700px;
            overflow-y: auto;
            padding: 20px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
        }
        
        .preview-empty {
            text-align: center;
            padding: 32px;
            color: var(--text-muted);
            font-size: 0.875rem;
        }
        
        .preview-label {
            transform: scale(0.45);
            transform-origin: top left;
            width: 210mm;
            height: auto;
            pointer-events: none;
            margin-bottom: -200px;
        }
        
        .preview-label.size-a4-landscape {
            transform: scale(0.35);
            width: 297mm;
            margin-bottom: -280px;
        }
        
        .preview-label-wrapper {
            overflow: hidden;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: white;
        }
        
        /* Parts List Styles */
        .parts-list-container {
            background: #f8f9fc;
            border-radius: 6px;
            padding: 8px 12px;
            margin-top: 6px;
        }
        
        .parts-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
            justify-content: center;
        }
        
        .part-item {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 8px;
            font-weight: 600;
            color: #6b7280;
            background: white;
            border: 1px solid #e5e7eb;
        }
        
        .part-item.active {
            background: var(--theme-color, #BE1622);
            color: white;
            border-color: var(--theme-color, #BE1622);
            font-weight: 800;
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .part-item .part-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
            opacity: 0.5;
        }
        
        .part-item.active .part-dot {
            opacity: 1;
            background: white;
        }
        
        .part-number-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--theme-color, #BE1622);
            color: white;
            font-size: 10px;
            font-weight: 800;
            padding: 2px 10px;
            border-radius: 10px;
            margin-left: 8px;
        }

        /* ═══════════════════════════════════════════════════════════════
           LOADING STATE
        ═══════════════════════════════════════════════════════════════ */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }
        
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top-color: var(--theme-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: white;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* ═══════════════════════════════════════════════════════════════
           PRINT STYLES
        ═══════════════════════════════════════════════════════════════ */
        @media print {
            /* Sadece etiketleri göster, diğer her şeyi gizle */
            body * {
                visibility: hidden;
            }
            #printArea, #printArea * {
                visibility: visible !important;
            }
            #printArea {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                display: block !important;
            }
            
            .no-print, 
            .toast-container, 
            .loading-overlay,
            .app-header,
            .sidebar,
            .main-content > *:not(#printArea),
            .preview-section,
            .content-area > *:not(#printArea) { 
                display: none !important; 
            }
            
            body { 
                background: white; 
                margin: 0; 
                padding: 0; 
            }
            
            .page-sheet { 
                break-after: page; 
                page-break-after: always;
                box-shadow: none;
                border: none;
                margin: 0;
                visibility: visible !important;
            }
            
            .page-sheet:first-child {
                page-break-before: avoid;
            }
            
            .lbl-logo {
                height: 32px !important;
                width: auto !important;
                max-width: 120px !important;
                object-fit: contain !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* SVG İkonlar için Print Kuralları */
            .icon-item svg,
            .metric-item svg,
            .icons-wrapper svg {
                visibility: visible !important;
                display: block !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color: #000000 !important;
                color-adjust: exact !important;
            }
            
            .icon-item svg *,
            .metric-item svg *,
            .icons-wrapper svg * {
                visibility: visible !important;
                stroke: #000000 !important;
                fill: #000000 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            .icon-item svg path[fill="none"],
            .icon-item svg line,
            .icon-item svg circle[fill="none"],
            .icon-item svg rect[fill="none"],
            .icon-item svg ellipse[fill="none"],
            .metric-item svg path[fill="none"],
            .metric-item svg line,
            .metric-item svg circle[fill="none"],
            .metric-item svg rect[fill="none"] {
                fill: none !important;
                stroke: #000000 !important;
            }
            
            .icon-item,
            .icons-wrapper,
            .metric-item {
                visibility: visible !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            .icon-text {
                visibility: visible !important;
                color: #000000 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* A4 Landscape Print */
            .page-sheet.size-a4-landscape {
                width: 297mm !important;
                height: 210mm !important;
            }
            .page-sheet.size-a4-landscape .lbl-logo {
                height: 50px !important;
                max-width: 200px !important;
            }
        }
        
        /* A4 Landscape için ayrı @page kuralı */
        @media print {
            @page {
                margin: 0;
            }
        }
        
        #printArea { display: none; }
        
        /* Label Size Variations */
        .page-sheet {
            background: white;
            margin: 0 auto 20px;
            position: relative;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
        }
        
        .page-sheet.size-a4-half {
            width: 210mm;
            height: 297mm;
        }
        
        /* A4 Landscape - Full Page Single Label - BÜYÜK VE NET TASARIM */
        .page-sheet.size-a4-landscape {
            width: 297mm;
            height: 210mm;
            position: relative;
        }
        
        .page-sheet.size-a4-landscape .page-info {
            position: absolute;
            top: 2mm;
            left: 4mm;
            font-size: 8px;
            z-index: 10;
        }
        
        .page-sheet.size-a4-landscape .date-stamp {
            position: absolute;
            top: 2mm;
            right: 4mm;
            font-size: 8px;
            z-index: 10;
        }
        
        .page-sheet.size-a4-landscape .label-container {
            width: 100% !important;
            height: 100% !important;
            padding: 4mm !important;
            box-sizing: border-box;
        }
        
        .page-sheet.size-a4-landscape .cut-line {
            display: none !important;
        }
        
        .page-sheet.size-a4-landscape .label-box {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            border-width: 3px;
            border-radius: 10px;
        }
        
        /* HEADER - Logo ve Başlık */
        .page-sheet.size-a4-landscape .lbl-header {
            height: 65px;
            min-height: 65px;
            padding: 0 30px;
            flex-shrink: 0;
            background: linear-gradient(135deg, #fafafa 0%, #f0f0f0 100%);
        }
        
        .page-sheet.size-a4-landscape .lbl-logo {
            height: 50px;
            max-width: 200px;
        }
        
        .page-sheet.size-a4-landscape .lbl-service {
            font-size: 22px;
            font-weight: 800;
            letter-spacing: 2px;
        }
        
        /* ADRESLER - Yan yana, büyük fontlar */
        .page-sheet.size-a4-landscape .lbl-addresses {
            flex: 1;
            min-height: 0;
            display: flex;
        }
        
        .page-sheet.size-a4-landscape .lbl-sender {
            flex: 4;
            padding: 15px 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .page-sheet.size-a4-landscape .lbl-receiver {
            flex: 6;
            padding: 15px 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: #fffef5;
        }
        
        .page-sheet.size-a4-landscape .section-label {
            font-size: 11px;
            margin-bottom: 8px;
            letter-spacing: 2px;
        }
        
        .page-sheet.size-a4-landscape .lbl-sender .company-name {
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .page-sheet.size-a4-landscape .lbl-sender .address-text {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .page-sheet.size-a4-landscape .lbl-receiver .company-name {
            font-size: 16px;
        }
        
        .page-sheet.size-a4-landscape .receiver-big {
            font-size: 32px !important;
            font-weight: 900 !important;
            line-height: 1.1;
            margin-bottom: 8px;
        }
        
        .page-sheet.size-a4-landscape .lbl-receiver .address-text {
            font-size: 16px;
            line-height: 1.5;
            font-weight: 500;
        }
        
        /* İÇERİK BİLGİSİ - Ürün ve Paket */
        .page-sheet.size-a4-landscape .lbl-details {
            min-height: 120px;
            flex-shrink: 0;
            background: #f8f9fc;
        }
        
        .page-sheet.size-a4-landscape .lbl-detail-col {
            padding: 12px 30px;
        }
        
        .page-sheet.size-a4-landscape .lbl-detail-col.wide {
            flex: 7;
            justify-content: center;
        }
        
        .page-sheet.size-a4-landscape .lbl-detail-col.narrow {
            flex: 3;
            background: #f0f1f5;
        }
        
        .page-sheet.size-a4-landscape .product-name-label {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 6px;
            letter-spacing: 0.5px;
        }
        
        .page-sheet.size-a4-landscape .part-name-label {
            font-size: 20px;
            font-weight: 700;
        }
        
        .page-sheet.size-a4-landscape .parts-list-container {
            padding: 12px 18px;
            margin-top: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .page-sheet.size-a4-landscape .part-item {
            font-size: 12px;
            padding: 6px 14px;
            border-radius: 6px;
        }
        
        .page-sheet.size-a4-landscape .part-item.active {
            transform: scale(1.08);
            box-shadow: 0 3px 12px rgba(0,0,0,0.2);
        }
        
        .page-sheet.size-a4-landscape .part-number-badge {
            font-size: 14px;
            font-weight: 900;
            padding: 5px 16px;
            border-radius: 12px;
        }
        
        .page-sheet.size-a4-landscape .package-badge {
            transform: scale(1.1);
        }
        
        .page-sheet.size-a4-landscape .package-val {
            font-size: 64px;
            font-weight: 900;
            line-height: 1;
        }
        
        .page-sheet.size-a4-landscape .package-label-text {
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 1px;
            margin-top: 4px;
        }
        
        /* FOOTER - İkonlar ve Barkod */
        .page-sheet.size-a4-landscape .lbl-footer {
            min-height: 90px;
            padding: 10px 30px;
            flex-shrink: 0;
        }
        
        .page-sheet.size-a4-landscape .footer-left {
            max-width: 40%;
        }
        
        .page-sheet.size-a4-landscape .footer-right {
            max-width: 25%;
        }
        
        .page-sheet.size-a4-landscape .icon-item {
            min-width: 40px;
            max-width: 55px;
        }
        
        .page-sheet.size-a4-landscape .icon-item svg {
            width: 38px;
            height: 38px;
        }
        
        .page-sheet.size-a4-landscape .icon-text {
            font-size: 7px;
            max-width: 55px;
            font-weight: 900;
        }
        
        .page-sheet.size-a4-landscape .icons-wrapper {
            gap: 12px;
        }
        
        .page-sheet.size-a4-landscape .icons-wrapper.compact .icon-item {
            min-width: 32px;
            max-width: 42px;
        }
        
        .page-sheet.size-a4-landscape .icons-wrapper.compact .icon-item svg {
            width: 30px;
            height: 30px;
        }
        
        .page-sheet.size-a4-landscape .icons-wrapper.compact .icon-text {
            font-size: 6px;
        }
        
        .page-sheet.size-a4-landscape .barcode-area {
            transform: scale(1.3);
        }
        
        .page-sheet.size-a4-landscape .barcode-svg {
            height: 45px;
        }
        
        .page-sheet.size-a4-landscape .tracking-no {
            font-size: 14px;
            font-weight: 700;
            margin-top: 5px;
            letter-spacing: 1px;
        }
        
        @media print {
            .page-sheet.size-a4-landscape {
                width: 297mm !important;
                height: 210mm !important;
            }
            .page-sheet.size-a4-landscape .label-container {
                width: 100% !important;
                height: 100% !important;
            }
        }
        
        .page-sheet.size-a5 {
            width: 210mm;
            height: 148mm;
        }
        
        .page-sheet.size-a5 .label-container {
            height: 100%;
        }
        
        .page-sheet.size-a5 .cut-line {
            display: none;
        }
        
        .page-sheet.size-a5 .label-container:last-child {
            display: none;
        }
        
        .page-sheet.size-thermal-100x150 {
            width: 100mm;
            height: 150mm;
        }
        
        .page-sheet.size-thermal-100x150 .label-container {
            height: 100%;
            padding: 5mm;
        }
        
        .page-sheet.size-thermal-100x150 .cut-line,
        .page-sheet.size-thermal-100x150 .label-container:last-child {
            display: none;
        }
        
        .page-sheet.size-thermal-100x150 .label-box {
            font-size: 0.85em;
        }
        
        .page-sheet.size-thermal-100x150 .lbl-header {
            height: 45px;
            padding: 0 15px;
        }
        
        .page-sheet.size-thermal-100x150 .lbl-logo {
            height: 24px;
            width: auto;
            max-width: 80px;
            object-fit: contain;
        }
        
        .page-sheet.size-thermal-100x150 .lbl-service {
            font-size: 11px;
        }
        
        .page-sheet.size-thermal-100x150 .lbl-details {
            height: 70px;
        }
        
        .page-sheet.size-thermal-100x150 .lbl-footer {
            min-height: 60px;
            padding: 5px 10px;
        }
        
        .page-sheet.size-thermal-100x70 {
            width: 100mm;
            height: 70mm;
        }
        
        .page-sheet.size-thermal-100x70 .label-container {
            height: 100%;
            padding: 3mm;
        }
        
        .page-sheet.size-thermal-100x70 .cut-line,
        .page-sheet.size-thermal-100x70 .label-container:last-child,
        .page-sheet.size-thermal-100x70 .page-info,
        .page-sheet.size-thermal-100x70 .date-stamp {
            display: none;
        }
        
        .page-sheet.size-thermal-100x70 .label-box {
            font-size: 0.7em;
        }
        
        .page-sheet.size-thermal-100x70 .lbl-header {
            height: 30px;
            padding: 0 8px;
        }
        
        .page-sheet.size-thermal-100x70 .lbl-logo {
            height: 18px;
            width: auto;
            max-width: 60px;
            object-fit: contain;
        }
        
        .page-sheet.size-thermal-100x70 .lbl-service {
            font-size: 9px;
        }
        
        .page-sheet.size-thermal-100x70 .lbl-addresses {
            flex-grow: 0;
        }
        
        .page-sheet.size-thermal-100x70 .lbl-sender,
        .page-sheet.size-thermal-100x70 .lbl-receiver {
            padding: 8px;
        }
        
        .page-sheet.size-thermal-100x70 .company-name {
            font-size: 10px;
        }
        
        .page-sheet.size-thermal-100x70 .address-text {
            font-size: 8px;
        }
        
        .page-sheet.size-thermal-100x70 .lbl-details {
            height: 50px;
        }
        
        .page-sheet.size-thermal-100x70 .product-name-label {
            font-size: 12px;
        }
        
        .page-sheet.size-thermal-100x70 .package-val {
            font-size: 20px;
        }
        
        .page-sheet.size-thermal-100x70 .lbl-footer {
            min-height: 40px;
            padding: 3px 8px;
        }
        
        .page-sheet.size-thermal-100x70 .barcode-svg {
            height: 25px;
        }
        
        .page-sheet.size-thermal-100x70 .tracking-no {
            font-size: 8px;
        }
        
        .cut-line {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 0;
            border-top: 1px dashed #9ca3af;
            z-index: 10;
            transform: translateY(-0.5px);
        }
        
        .cut-line::after {
            content: attr(data-text);
            position: absolute;
            top: -9px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 0 12px;
            color: #9ca3af;
            font-size: 9px;
            font-weight: 600;
            letter-spacing: 2px;
            white-space: nowrap;
        }
        
        .page-info {
            position: absolute;
            top: 6mm;
            right: 6mm;
            font-size: 9px;
            color: #d1d1d6;
            font-weight: 600;
        }
        
        .date-stamp {
            position: absolute;
            top: 6mm;
            left: 6mm;
            font-size: 9px;
            color: #d1d1d6;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .label-container {
            width: 100%;
            height: 50%;
            padding: 15mm;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .label-box {
            width: 100%;
            height: 100%;
            border: 2px solid var(--print-border);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            background: white;
            overflow: hidden;
            font-family: 'Montserrat', sans-serif;
        }
        
        .lbl-header {
            height: 65px;
            border-bottom: 1px solid #e5e5ea;
            padding: 0 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .lbl-logo { 
            height: 32px; 
            width: auto;
            max-width: 120px;
            object-fit: contain;
            object-position: left center;
            flex-shrink: 0;
        }
        
        .lbl-service {
            font-weight: 700;
            font-size: 14px;
            color: var(--theme-color);
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }
        
        .lbl-addresses {
            display: flex;
            flex-grow: 1;
            border-bottom: 1px solid #e5e5ea;
        }
        
        .lbl-sender,
        .lbl-receiver {
            width: 50%;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .lbl-sender {
            border-right: 1px solid #e5e5ea;
        }
        
        .section-label {
            font-size: 8px;
            color: #86868b;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }
        
        .company-name {
            font-size: 13px;
            font-weight: 700;
            color: var(--print-black);
            margin-bottom: 4px;
            text-transform: uppercase;
        }
        
        .receiver-big {
            font-size: 16px;
            font-weight: 800;
        }
        
        .address-text {
            font-size: 11px;
            line-height: 1.5;
            font-weight: 500;
            color: #555;
        }
        
        .lbl-details {
            display: flex;
            min-height: 100px;
            border-bottom: 1px solid #e5e5ea;
        }
        
        .lbl-detail-col {
            padding: 12px 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .lbl-detail-col.wide {
            flex: 7;
            border-right: 1px solid #e5e5ea;
            align-items: flex-start;
            justify-content: flex-start;
            padding-top: 10px;
            padding-bottom: 10px;
        }
        
        .lbl-detail-col.narrow {
            flex: 3;
            align-items: center;
            background-color: #fafafa;
        }
        
        .product-name-label {
            font-size: 18px;
            font-weight: 700;
            color: var(--print-black);
            margin-bottom: 2px;
            text-transform: uppercase;
            line-height: 1.2;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .part-name-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--theme-color);
            margin-top: 4px;
        }
        
        .package-badge {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .package-val {
            font-size: 32px;
            font-weight: 800;
            color: var(--print-black);
            line-height: 1;
        }
        
        .package-val-divider {
            font-size: 16px;
            color: #bbb;
        }
        
        .package-label-text {
            font-size: 10px;
            font-weight: 600;
            color: #86868b;
            margin-top: 4px;
            text-transform: uppercase;
        }
        
        .lbl-footer {
            min-height: 85px;
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }
        
        .footer-left,
        .footer-right {
            flex: 0 1 auto;
            min-width: 0;
            max-width: 35%;
        }
        
        .footer-center {
            flex: 1 1 auto;
            display: flex;
            justify-content: center;
        }
        
        .footer-right {
            display: flex;
            justify-content: flex-end;
        }
        
        .icons-wrapper {
            display: flex;
            gap: 6px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: flex-start;
        }
        
        .footer-right .icons-wrapper {
            justify-content: flex-end;
        }
        
        .icon-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1px;
            min-width: 24px;
            max-width: 36px;
        }
        
        .icon-item svg {
            width: 22px;
            height: 22px;
            fill: var(--print-black);
            stroke: var(--print-black);
            flex-shrink: 0;
        }
        
        .icon-text {
            font-size: 5px;
            font-weight: 800;
            text-transform: uppercase;
            color: var(--print-black);
            text-align: center;
            line-height: 1.05;
            max-width: 38px;
            word-wrap: break-word;
            overflow: hidden;
        }
        
        /* Compact mode when many icons */
        .icons-wrapper.compact .icon-item {
            min-width: 20px;
            max-width: 28px;
        }
        
        .icons-wrapper.compact .icon-item svg {
            width: 18px;
            height: 18px;
        }
        
        .icons-wrapper.compact .icon-text {
            font-size: 4px;
            max-width: 30px;
        }


        /* Metrics (Weight / Volume / Volumetric) */

        /* Footer stacks (warnings + metrics) */
        .footer-left-stack {
            display: flex;
            flex-direction: column;
            gap: 6px;
            align-items: flex-start;
        }

        .footer-right-stack {
            display: flex;
            flex-direction: column;
            gap: 6px;
            align-items: flex-end;
        }
        .metrics-wrapper {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: flex-start;
        }

        .metric-item {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 3px 6px;
            border: 1px solid var(--print-black);
            border-radius: 10px;
            white-space: nowrap;
        }

        .metric-item svg {
            width: 18px;
            height: 18px;
            fill: none;
            stroke: var(--print-black);
            stroke-width: 5;
            stroke-linecap: round;
            stroke-linejoin: round;
            flex-shrink: 0;
        }

        .metric-lines {
            display: flex;
            flex-direction: column;
            line-height: 1.05;
        }

        .metric-value {
            font-size: 10px;
            font-weight: 900;
            letter-spacing: 0.2px;
        }

        .metric-label {
            font-size: 5px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.6px;
        }

        .barcode-area {
            text-align: center;
            margin: 0 15px;
        }
        
        .barcode-svg {
            height: 40px;
        }
        
        .qr-code {
            width: 60px;
            height: 60px;
        }
        
        .tracking-no {
            font-size: 12px;
            letter-spacing: 3px;
            margin-top: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--print-black);
        }

        /* ═══════════════════════════════════════════════════════════════
           ANIMATIONS
        ═══════════════════════════════════════════════════════════════ */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-in {
            animation: fadeInUp 0.4s ease forwards;
        }
        
        .product-row {
            animation: fadeInUp 0.3s ease;
        }
        
        /* Logo Upload Styles */
        .logo-upload-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .logo-preview {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
        }
        
        .logo-preview img {
            max-height: 50px;
            max-width: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
        }
        
        .logo-remove-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--color-error);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all var(--transition-fast);
        }
        
        .logo-remove-btn:hover {
            transform: scale(1.1);
        }
        
        .logo-upload-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all var(--transition-fast);
        }
        
        .logo-upload-btn:hover {
            border-color: var(--theme-color);
            color: var(--theme-color);
            background: var(--theme-light);
        }
        
        .logo-upload-btn i {
            font-size: 1.2em;
        }
        
        /* Dimensions inputs in product row */
        .dimensions-row {
            display: flex;
            gap: 6px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        
        .dim-input {
            width: 60px;
            padding: 6px 8px;
            font-size: 0.75rem;
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            text-align: center;
        }
        
        .dim-input:focus {
            border-color: var(--theme-color);
            outline: none;
        }
        
        .dim-input::placeholder {
            color: var(--text-muted);
            font-size: 0.65rem;
        }
        
        .dim-label {
            font-size: 0.6rem;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 2px;
            display: block;
        }
        
        .dim-group {
            display: flex;
            flex-direction: column;
        }
        
        /* Desi badge */
        .desi-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: var(--theme-light);
            color: var(--theme-color);
            border-radius: var(--radius-sm);
            font-size: 0.7rem;
            font-weight: 700;
        }
        
        /* Stats bar extended */
        .stat-divider {
            width: 1px;
            height: 30px;
            background: var(--border-color);
            margin: 0 8px;
        }
    </style>
</head>
<body>
    <!-- ═══════════════════════════════════════════════════════════════
         HEADER
    ═══════════════════════════════════════════════════════════════ -->
    <header class="app-header no-print">
        <div class="header-inner">
            <div class="header-left">
                <img src="https://static.ticimax.cloud/69640/uploads/editoruploads/gasell-logo-0.svg" alt="Gasell" class="header-logo">
                <span class="header-version" id="headerVersion">PRO v7.0</span>
            </div>
            
            <div class="header-right">
                <!-- Keyboard Shortcuts -->
                <div class="shortcuts-hint">
                    <kbd class="kbd">Ctrl</kbd>+<kbd class="kbd">P</kbd> <span data-i18n="print">Yazdır</span>
                    <span style="margin: 0 8px;">|</span>
                    <kbd class="kbd">Ctrl</kbd>+<kbd class="kbd">Z</kbd> <span>Geri Al</span>
                </div>
                
                <!-- Language Selector -->
                <div class="lang-selector">
                    <button onclick="setLanguage('tr')" id="lang-tr" class="lang-btn active" title="Türkçe">
                        🇹🇷
                    </button>
                    <button onclick="setLanguage('en')" id="lang-en" class="lang-btn" title="English">
                        🇬🇧
                    </button>
                </div>
                
                <!-- Theme Toggle -->
                <button onclick="toggleTheme()" class="btn btn-ghost btn-icon" title="Tema Değiştir" aria-label="Tema değiştir">
                    <i class="fa-solid fa-moon" id="themeIcon"></i>
                </button>
                
                <!-- Templates Dropdown -->
                <div class="dropdown" id="templatesDropdown">
                    <button onclick="toggleDropdown('templatesDropdown')" class="btn btn-secondary">
                        <i class="fa-solid fa-bookmark"></i>
                        <span class="dropdown-btn-text" data-i18n="templates">Şablonlar</span>
                        <i class="fa-solid fa-chevron-down" style="font-size: 0.7rem; margin-left: 4px;"></i>
                    </button>
                    <div class="dropdown-menu">
                        <div class="dropdown-item" onclick="saveAsTemplate()">
                            <i class="fa-solid fa-plus" style="color: var(--color-success);"></i>
                            <span data-i18n="saveAsTemplate">Şablon Olarak Kaydet</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div id="templatesList">
                            <div class="dropdown-empty" data-i18n="noTemplates">Kayıtlı şablon yok</div>
                        </div>
                    </div>
                </div>
                
                <!-- Help -->
                <button onclick="openModal('helpModal')" class="btn btn-ghost btn-icon" title="Yardım">
                    <i class="fa-solid fa-question"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- ═══════════════════════════════════════════════════════════════
         MAIN APP
    ═══════════════════════════════════════════════════════════════ -->
    <div class="app-wrapper">
        <div class="app-container no-print">
            
            <!-- SIDEBAR -->
            <aside class="sidebar">
                <div class="card">
                    <!-- Color Theme -->
                    <div class="card-header">
                        <span class="card-title" data-section="labelTheme">Etiket Teması</span>
                    </div>
                    <div class="color-picker">
                        <div onclick="setTheme('#BE1622', this)" class="color-option active" style="background:#BE1622" title="Gasell Kırmızı" data-color="#BE1622"></div>
                        <div onclick="setTheme('#2563eb', this)" class="color-option" style="background:#2563eb" title="İhracat Mavi" data-color="#2563eb"></div>
                        <div onclick="setTheme('#059669', this)" class="color-option" style="background:#059669" title="Onaylı Yeşil" data-color="#059669"></div>
                        <div onclick="setTheme('#7c3aed', this)" class="color-option" style="background:#7c3aed" title="Premium Mor" data-color="#7c3aed"></div>
                        <div onclick="setTheme('#1a1a1a', this)" class="color-option" style="background:#1a1a1a" title="Endüstriyel Siyah" data-color="#1a1a1a"></div>
                    </div>
                </div>

                <div class="card">
                    <!-- Warning Icons -->
                    <div class="card-header">
                        <span class="card-title" data-section="logisticSymbols">Lojistik Sembolleri (ISO 780:2015)</span>
                    </div>
                    <div class="checkbox-grid">
                        <div onclick="toggleIcon('fragile')" id="btn-fragile" class="checkbox-btn active" role="checkbox" aria-checked="true" tabindex="0" data-icon="fragile">
                            <i class="fa-solid fa-wine-glass-crack"></i> <span>Kırılabilir</span>
                        </div>
                        <div onclick="toggleIcon('up')" id="btn-up" class="checkbox-btn active" role="checkbox" aria-checked="true" tabindex="0" data-icon="up">
                            <i class="fa-solid fa-arrows-up-to-line"></i> <span>Bu Yön</span>
                        </div>
                        <div onclick="toggleIcon('dry')" id="btn-dry" class="checkbox-btn" role="checkbox" aria-checked="false" tabindex="0" data-icon="dry">
                            <i class="fa-solid fa-umbrella"></i> <span>Kuru Tut</span>
                        </div>
                        <div onclick="toggleIcon('knife')" id="btn-knife" class="checkbox-btn active" role="checkbox" aria-checked="true" tabindex="0" data-icon="knife">
                            <i class="fa-solid fa-scissors"></i> <span>Bıçak Yok</span>
                        </div>
                        <div onclick="toggleIcon('heat')" id="btn-heat" class="checkbox-btn" role="checkbox" aria-checked="false" tabindex="0" data-icon="heat">
                            <i class="fa-solid fa-temperature-high"></i> <span>Isıdan Koru</span>
                        </div>
                        <div onclick="toggleIcon('nostack')" id="btn-nostack" class="checkbox-btn" role="checkbox" aria-checked="false" tabindex="0" data-icon="nostack">
                            <i class="fa-solid fa-layer-group"></i> <span>Üst Üste Yok</span>
                        </div>
                        <div onclick="toggleIcon('care')" id="btn-care" class="checkbox-btn" role="checkbox" aria-checked="false" tabindex="0" data-icon="care">
                            <i class="fa-solid fa-hands-holding"></i> <span>Dikkatli Taşı</span>
                        </div>
                        <div onclick="toggleIcon('sling')" id="btn-sling" class="checkbox-btn" role="checkbox" aria-checked="false" tabindex="0" data-icon="sling">
                            <i class="fa-solid fa-anchor"></i> <span>Kaldırma Nok.</span>
                        </div>
                    </div>
                    
                    <!-- Barcode Type -->
                    <div class="barcode-toggle">
                        <label class="form-label" data-label="codeType">Kod Tipi</label>
                        <div class="barcode-buttons">
                            <button onclick="setBarcodeType('barcode')" id="btn-barcode" class="btn btn-secondary active">
                                <i class="fa-solid fa-barcode"></i> Barkod
                            </button>
                            <button onclick="setBarcodeType('qr')" id="btn-qr" class="btn btn-secondary">
                                <i class="fa-solid fa-qrcode"></i> QR Kod
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <!-- Addresses -->
                    <div class="card-header">
                        <span class="card-title" data-section="addressInfo">Adres Bilgileri</span>
                    </div>
                    
                    <!-- Gönderen - Sabit Gasell Bilgileri -->
                    <div class="address-section sender-fixed">
                        <div class="sender-header">
                            <label class="form-label section-title" data-label="sender">
                                <i class="fa-solid fa-building"></i> Gönderen
                            </label>
                            <button type="button" class="btn btn-ghost btn-sm" onclick="toggleSenderEdit()" id="senderEditBtn">
                                <i class="fa-solid fa-pen"></i> Düzenle
                            </button>
                        </div>
                        
                        <!-- Sabit Görünüm -->
                        <div class="sender-display" id="senderDisplay">
                            <div class="sender-info-card">
                                <div class="sender-company">GASELL OFİS MOBİLYALARI</div>
                                <div class="sender-details">
                                    İkitelli OSB Mah. Masko Mobilyacılar San. Sit. 8/A Blok No:19<br>
                                    Başakşehir / İSTANBUL<br>
                                    Tel: +90 533 306 63 53
                                </div>
                            </div>
                        </div>
                        
                        <!-- Düzenleme Formu (Gizli) -->
                        <div class="address-fields sender-edit-form" id="senderEditForm" style="display: none;">
                            <input type="text" id="senderCompany" class="form-input" placeholder="Firma Adı" value="GASELL OFİS MOBİLYALARI">
                            <input type="text" id="senderPerson" class="form-input" placeholder="Yetkili Kişi (opsiyonel)">
                            <input type="tel" id="senderPhone" class="form-input" placeholder="Telefon" value="+90 533 306 63 53">
                            <input type="text" id="senderStreet" class="form-input" placeholder="Mahalle, Cadde, Sokak, No" value="İkitelli OSB Mah. Masko Mobilyacılar San. Sit. 8/A Blok No:19">
                            <div class="address-row">
                                <input type="text" id="senderDistrict" class="form-input" placeholder="İlçe" value="Başakşehir">
                                <input type="text" id="senderCity" class="form-input" placeholder="İl" value="İSTANBUL">
                            </div>
                            <button type="button" class="btn btn-primary btn-sm" onclick="saveSenderInfo()" style="margin-top: 8px;">
                                <i class="fa-solid fa-check"></i> Kaydet
                            </button>
                        </div>
                    </div>

                    <!-- Alıcı Detaylı -->
                    <div class="address-section receiver-section">
                        <label class="form-label section-title" data-label="receiver">
                            <i class="fa-solid fa-truck"></i> Alıcı
                        </label>
                        <div class="address-fields">
                            <input type="text" id="receiverCompany" class="form-input receiver-highlight" placeholder="Firma Adı">
                            <input type="text" id="receiverPerson" class="form-input receiver-highlight" placeholder="Yetkili Kişi">
                            <input type="tel" id="receiverPhone" class="form-input" placeholder="Telefon">
                            <input type="text" id="receiverStreet" class="form-input" placeholder="Mahalle, Cadde, Sokak, No">
                            <div class="address-row">
                                <input type="text" id="receiverDistrict" class="form-input" placeholder="İlçe">
                                <input type="text" id="receiverCity" class="form-input" placeholder="İl">
                            </div>
                        </div>
                    </div>

                    <!-- Takip Kodu - Otomatik Oluşur -->
                    <div class="form-group">
                        <label class="form-label"><i class="fa-solid fa-barcode"></i> Takip Kodu (Otomatik)</label>
                        <div class="auto-code-preview" id="autoCodePreview">
                            <span class="code-placeholder">Alıcı firma adını girin...</span>
                        </div>
                        <input type="hidden" id="codePrefix" value="">
                        <input type="hidden" id="startNo" value="1">
                    </div>
                </div>
                
                <!-- Label Settings Card -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title" data-section="labelSettings">Etiket Ayarları</span>
                    </div>
                    
                    <!-- Label Size -->
                    <div class="form-group">
                        <label class="form-label" data-label="labelSize">Etiket Boyutu</label>
                        <select id="labelSizeSelect" class="form-input" onchange="setLabelSize(this.value)">
                            <option value="a4-landscape">A4 Yatay - Tek Etiket (297x210mm) ⭐</option>
                            <option value="a4-half">A4 Dikey - 2 Etiket (210x148mm)</option>
                            <option value="a5">A5 (210x148mm)</option>
                            <option value="thermal-100x150">Termal 100x150mm</option>
                            <option value="thermal-100x70">Termal 100x70mm</option>
                        </select>
                    </div>
                    
                    <!-- Custom Logo -->
                    <div class="form-group">
                        <label class="form-label" data-label="customLogo">Özel Logo</label>
                        <div class="logo-upload-area">
                            <div id="logoPreview" class="logo-preview hidden">
                                <img id="logoPreviewImg" src="" alt="Logo">
                                <button onclick="removeLogo()" class="logo-remove-btn" title="Logoyu Kaldır">
                                    <i class="fa-solid fa-times"></i>
                                </button>
                            </div>
                            <label class="logo-upload-btn" id="logoUploadLabel">
                                <input type="file" id="logoInput" accept="image/*" onchange="handleLogoUpload(event)" hidden>
                                <i class="fa-solid fa-cloud-upload-alt"></i>
                                <span data-label="uploadLogo">Logo Yükle</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Show Dimensions Toggle -->
                    <div class="form-group">
                        <div onclick="toggleDimensions()" id="btn-dimensions" class="checkbox-btn" role="checkbox" aria-checked="false" tabindex="0" data-icon="dimensions" style="width: 100%;">
                            <i class="fa-solid fa-ruler-combined"></i> <span data-label="showDimensions">Ölçü/Ağırlık Göster</span>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button onclick="generateLabels()" class="btn btn-primary btn-lg btn-block" data-btn="generateLabels">
                        <i class="fa-solid fa-print"></i> ETİKETLERİ OLUŞTUR
                    </button>
                    <div class="action-buttons-row">
                        <button onclick="exportPDF()" class="btn btn-secondary" data-btn="downloadPdf">
                            <i class="fa-solid fa-file-pdf"></i> PDF İndir
                        </button>
                        <button onclick="printLabels()" class="btn btn-secondary" data-btn="print">
                            <i class="fa-solid fa-print"></i> Yazdır
                        </button>
                    </div>
                    <button onclick="openMultiReceiverModal()" class="btn btn-secondary btn-block" data-btn="multiReceiver">
                        <i class="fa-solid fa-users"></i> Çoklu Alıcı Modu
                    </button>
                </div>
            </aside>

            <!-- MAIN CONTENT -->
            <main class="main-content">
                <div class="card">
                    <div class="list-header">
                        <div class="list-header-info">
                            <h1 data-text="productList">Ürün Listesi</h1>
                            <p data-text="productListDesc">Paketleri sürükleyerek sıralayın, içerikleri düzenleyin.</p>
                        </div>
                        <div class="list-header-actions">
                            <button onclick="undoAction()" class="btn btn-ghost btn-icon" title="Geri Al (Ctrl+Z)" id="undoBtn" disabled>
                                <i class="fa-solid fa-rotate-left"></i>
                            </button>
                            <button onclick="redoAction()" class="btn btn-ghost btn-icon" title="İleri Al (Ctrl+Y)" id="redoBtn" disabled>
                                <i class="fa-solid fa-rotate-right"></i>
                            </button>
                            <button onclick="openModal('bulkModal')" class="btn btn-secondary" data-btn="bulkAdd">
                                <i class="fa-solid fa-paste"></i> Toplu Ekle
                            </button>
                            <button onclick="addProduct()" class="btn btn-primary" data-btn="add">
                                <i class="fa-solid fa-plus"></i> Ekle
                            </button>
                        </div>
                    </div>

                    <!-- Stats Bar -->
                    <div class="stats-bar" id="statsBar">
                        <div class="stat-item">
                            <div class="stat-icon"><i class="fa-solid fa-box"></i></div>
                            <div class="stat-info">
                                <span class="stat-value" id="statProducts">0</span>
                                <span class="stat-label" data-stat="product">Ürün</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon"><i class="fa-solid fa-boxes-stacked"></i></div>
                            <div class="stat-info">
                                <span class="stat-value" id="statPackages">0</span>
                                <span class="stat-label" data-stat="package">Paket</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon"><i class="fa-solid fa-file"></i></div>
                            <div class="stat-info">
                                <span class="stat-value" id="statPages">0</span>
                                <span class="stat-label" data-stat="page">Sayfa</span>
                            </div>
                        </div>
                        <div class="stat-item stat-highlight">
                            <div class="stat-icon"><i class="fa-solid fa-cube"></i></div>
                            <div class="stat-info">
                                <span class="stat-value" id="statDesi">0</span>
                                <span class="stat-label" data-stat="desi">Desi</span>
                            </div>
                        </div>
                        <div class="stat-item stat-highlight">
                            <div class="stat-icon"><i class="fa-solid fa-weight-hanging"></i></div>
                            <div class="stat-info">
                                <span class="stat-value" id="statWeight">0</span>
                                <span class="stat-label" data-stat="weight">kg</span>
                            </div>
                        </div>
                    </div>

                    <!-- Product List -->
                    <div id="productList" class="product-list">
                        <!-- Rendered dynamically -->
                    </div>

                    <!-- Empty State -->
                    <div id="emptyState" class="empty-state hidden">
                        <i class="fa-solid fa-box-open"></i>
                        <p data-text="noProducts">Henüz ürün eklenmedi</p>
                        <button onclick="addProduct()" class="btn btn-primary" data-btn="addFirst">
                            <i class="fa-solid fa-plus"></i> İlk Ürünü Ekle
                        </button>
                    </div>
                </div>
                
                <!-- Preview Section -->
                <div class="card">
                    <div class="preview-toggle" onclick="togglePreview()">
                        <span class="card-title" data-text="labelPreview"><i class="fa-solid fa-eye"></i>Etiket Önizleme</span>
                        <i class="fa-solid fa-chevron-down chevron" id="previewChevron"></i>
                    </div>
                    <div class="preview-content" id="previewContent">
                        <div class="preview-scroll" id="previewScroll">
                            <p class="preview-empty" data-text="previewHint">Önizleme için "Etiketleri Oluştur" butonuna tıklayın</p>
                        </div>
                        <button onclick="openZoomPreview()" class="btn btn-secondary" style="width: 100%; margin-top: 10px;">
                            <i class="fa-solid fa-search-plus"></i> Büyük Önizleme (Zoom)
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════
         MODALS
    ═══════════════════════════════════════════════════════════════ -->
    
    <!-- Bulk Add Modal -->
    <div class="modal-overlay" id="bulkModal" onclick="closeModalOnOverlay(event, 'bulkModal')">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title" data-modal="bulkTitle">Toplu Ürün Ekle</h2>
                <button onclick="closeModal('bulkModal')" class="btn btn-ghost btn-icon">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
            <div class="modal-hint">
                <p class="modal-hint-title" data-modal="bulkHint"><i class="fa-solid fa-lightbulb"></i> Format Örnekleri:</p>
                <code>
                    Masa {Tabla, Ayak, Konsol}<br>
                    Dolap *3<br>
                    Koltuk x2
                </code>
            </div>
            <textarea id="bulkText" rows="10" class="form-textarea mono" style="font-size: 0.875rem;" placeholder="Her satıra bir ürün yazın..."></textarea>
            <div class="modal-actions">
                <button onclick="closeModal('bulkModal')" class="btn btn-secondary" data-modal="bulkCancel">İptal</button>
                <button onclick="processBulkText()" class="btn btn-primary" data-modal="bulkApply">
                    <i class="fa-solid fa-check"></i> Uygula
                </button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal-overlay" id="helpModal" onclick="closeModalOnOverlay(event, 'helpModal')">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title" data-modal="helpTitle">Yardım & Kısayollar</h2>
                <button onclick="closeModal('helpModal')" class="btn btn-ghost btn-icon">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
            <div class="help-section">
                <h3 data-modal="shortcuts">Klavye Kısayolları</h3>
                <div class="help-shortcuts">
                    <div class="help-shortcut-row"><span>Print</span><span><kbd class="kbd">Ctrl</kbd>+<kbd class="kbd">P</kbd></span></div>
                    <div class="help-shortcut-row"><span>Save</span><span><kbd class="kbd">Ctrl</kbd>+<kbd class="kbd">S</kbd></span></div>
                    <div class="help-shortcut-row"><span>Undo</span><span><kbd class="kbd">Ctrl</kbd>+<kbd class="kbd">Z</kbd></span></div>
                    <div class="help-shortcut-row"><span>Redo</span><span><kbd class="kbd">Ctrl</kbd>+<kbd class="kbd">Y</kbd></span></div>
                    <div class="help-shortcut-row"><span>New</span><span><kbd class="kbd">Ctrl</kbd>+<kbd class="kbd">N</kbd></span></div>
                </div>
            </div>
            <div class="help-section">
                <h3 data-modal="features">Özellikler</h3>
                <div class="help-features">
                    ✓ Auto-save (LocalStorage)<br>
                    ✓ Drag & drop reorder<br>
                    ✓ Real barcode / QR code<br>
                    ✓ PDF export<br>
                    ✓ Template save<br>
                    ✓ Dark theme<br>
                    ✓ Multi-language (TR/EN)
                </div>
            </div>
        </div>
    </div>

    <!-- Zoom Preview Modal -->
    <div class="modal-overlay" id="zoomPreviewModal" onclick="closeModalOnOverlay(event, 'zoomPreviewModal')">
        <div class="modal zoom-modal-content" onclick="event.stopPropagation()">
            <div class="modal-header" style="padding: 15px 20px; background: var(--bg-secondary); border-bottom: 1px solid var(--border-color);">
                <h2 class="modal-title"><i class="fa-solid fa-search-plus"></i> Etiket Önizleme</h2>
                <button onclick="closeModal('zoomPreviewModal')" class="btn btn-ghost btn-icon">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
            <div class="zoom-container">
                <div class="zoom-label-wrapper" id="zoomLabelContainer">
                    <!-- Etiket buraya klonlanacak -->
                </div>
            </div>
            <div class="zoom-controls">
                <button onclick="zoomOut()" class="btn btn-secondary">
                    <i class="fa-solid fa-minus"></i>
                </button>
                <span id="zoomLevelDisplay" style="min-width: 60px; text-align: center; font-weight: 700;">100%</span>
                <button onclick="zoomIn()" class="btn btn-secondary">
                    <i class="fa-solid fa-plus"></i>
                </button>
                <button onclick="resetZoom()" class="btn btn-ghost" style="margin-left: 10px;">
                    <i class="fa-solid fa-undo"></i> Sıfırla
                </button>
            </div>
        </div>
    </div>

    <!-- Template Name Modal -->
    <div class="modal-overlay" id="templateNameModal" onclick="closeModalOnOverlay(event, 'templateNameModal')">
        <div class="modal modal-sm" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title" data-modal="templateTitle">Şablon Kaydet</h2>
                <button onclick="closeModal('templateNameModal')" class="btn btn-ghost btn-icon">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
            <div class="form-group">
                <label class="form-label" data-modal="templateLabel">Şablon Adı</label>
                <input type="text" id="templateName" class="form-input" placeholder="Örn: İhracat Şablonu">
            </div>
            <div class="modal-actions">
                <button onclick="closeModal('templateNameModal')" class="btn btn-secondary" data-modal="templateCancel">İptal</button>
                <button onclick="confirmSaveTemplate()" class="btn btn-primary" data-modal="templateSave">
                    <i class="fa-solid fa-save"></i> Kaydet
                </button>
            </div>
        </div>
    </div>
    
    <!-- Multi Receiver Modal -->
    <div class="modal-overlay" id="multiReceiverModal" onclick="closeModalOnOverlay(event, 'multiReceiverModal')">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title" data-modal="multiReceiverTitle">Çoklu Alıcı Modu</h2>
                <button onclick="closeModal('multiReceiverModal')" class="btn btn-ghost btn-icon">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
            <div class="modal-hint">
                <p class="modal-hint-title"><i class="fa-solid fa-lightbulb"></i> Aynı ürünleri birden fazla alıcıya gönder</p>
            </div>
            <div id="receiverListContainer">
                <!-- Dynamic receiver list -->
            </div>
            <button onclick="addReceiverField()" class="btn btn-secondary" style="margin-top: 12px; width: 100%;">
                <i class="fa-solid fa-plus"></i> <span data-i18n="addReceiver">Alıcı Ekle</span>
            </button>
            <div class="modal-actions">
                <button onclick="closeModal('multiReceiverModal')" class="btn btn-secondary">İptal</button>
                <button onclick="generateMultiReceiverLabels()" class="btn btn-primary">
                    <i class="fa-solid fa-print"></i> Tümü İçin Etiket Oluştur
                </button>
            </div>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════
         TOAST CONTAINER
    ═══════════════════════════════════════════════════════════════ -->
    <div class="toast-container no-print" id="toastContainer"></div>

    <!-- ═══════════════════════════════════════════════════════════════
         LOADING OVERLAY
    ═══════════════════════════════════════════════════════════════ -->
    <div class="loading-overlay no-print" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">PDF oluşturuluyor...</div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════
         PRINT AREA
    ═══════════════════════════════════════════════════════════════ -->
    <div id="printArea"></div>

    <!-- ═══════════════════════════════════════════════════════════════
         ISO 780:2015 PACKAGING SYMBOLS - INTERNATIONAL STANDARD
         Reference: ISO 7000 Graphical Symbols
    ═══════════════════════════════════════════════════════════════ -->
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="position:absolute;width:0;height:0;overflow:hidden;" aria-hidden="true">
        <defs>
            <!-- 
                ISO 7000-0621: FRAGILE / KIRILABILIR
                Broken wineglass symbol indicating fragile contents
            -->
            <symbol id="icon-fragile" viewBox="0 0 100 100">
                <!-- Wine glass bowl -->
                <path d="M30,8 L30,35 Q30,50 50,50 Q70,50 70,35 L70,8" 
                      fill="none" stroke="#000000" stroke-width="5" stroke-linejoin="round"/>
                <!-- Stem -->
                <line x1="50" y1="50" x2="50" y2="75" stroke="#000000" stroke-width="5"/>
                <!-- Base -->
                <path d="M32,75 L68,75 L68,80 L32,80 Z" fill="#000000"/>
                <!-- Crack lines (indicating broken) -->
                <path d="M50,15 L42,28 L54,35 L44,48" 
                      fill="none" stroke="#000000" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                <!-- Small crack piece flying off -->
                <path d="M58,20 L65,12 M60,25 L68,22" 
                      fill="none" stroke="#000000" stroke-width="3" stroke-linecap="round"/>
            </symbol>
            
            <!-- 
                ISO 7000-0623: THIS SIDE UP / BU YÖN YUKARI
                Two upward arrows with baseline indicating correct orientation
            -->
            <symbol id="icon-up" viewBox="0 0 100 100">
                <!-- Left arrow -->
                <path d="M30,70 L30,30 L15,45" fill="none" stroke="#000000" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M30,30 L45,45" fill="none" stroke="#000000" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
                <!-- Right arrow -->
                <path d="M70,70 L70,30 L55,45" fill="none" stroke="#000000" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M70,30 L85,45" fill="none" stroke="#000000" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
                <!-- Baseline -->
                <line x1="8" y1="88" x2="92" y2="88" stroke="#000000" stroke-width="6" stroke-linecap="round"/>
            </symbol>
            
            <!-- 
                ISO 7000-0626: KEEP DRY / KURU TUT
                Umbrella protecting from rain drops
            -->
            <symbol id="icon-dry" viewBox="0 0 100 100">
                <!-- Umbrella canopy -->
                <path d="M10,42 Q10,12 50,12 Q90,12 90,42" 
                      fill="none" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
                <!-- Umbrella handle (pole + curved end) -->
                <path d="M50,12 L50,78 Q50,88 58,88" 
                      fill="none" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
                <!-- Rain drops - left side -->
                <line x1="20" y1="52" x2="16" y2="62" stroke="#000000" stroke-width="4" stroke-linecap="round"/>
                <line x1="12" y1="68" x2="8" y2="78" stroke="#000000" stroke-width="4" stroke-linecap="round"/>
                <!-- Rain drops - right side -->
                <line x1="80" y1="52" x2="84" y2="62" stroke="#000000" stroke-width="4" stroke-linecap="round"/>
                <line x1="88" y1="68" x2="92" y2="78" stroke="#000000" stroke-width="4" stroke-linecap="round"/>
            </symbol>

            <!-- 
                ISO 7000-3596: DO NOT USE BLADES/KNIFE / BIÇAK KULLANMA
                Box cutter with prohibition circle
            -->
            <symbol id="icon-knife" viewBox="0 0 100 100">
                <!-- Prohibition circle -->
                <circle cx="50" cy="50" r="42" fill="none" stroke="#000000" stroke-width="5"/>
                <!-- Box cutter handle -->
                <rect x="28" y="42" width="30" height="16" rx="2" fill="#000000"/>
                <!-- Box cutter blade -->
                <polygon points="58,45 78,45 78,50 72,55 58,55" fill="#000000"/>
                <!-- Blade edge detail -->
                <line x1="58" y1="50" x2="72" y2="50" stroke="white" stroke-width="1"/>
                <!-- Prohibition diagonal line -->
                <line x1="20" y1="20" x2="80" y2="80" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
            </symbol>

            <!-- 
                ISO 7000-0627: PROTECT FROM HEAT / ISIDAN KORUYUN
                Package away from heat/sun source
            -->
            <symbol id="icon-heat" viewBox="0 0 100 100">
                <!-- Sun/heat source -->
                <circle cx="75" cy="25" r="12" fill="none" stroke="#000000" stroke-width="4"/>
                <!-- Sun rays -->
                <line x1="75" y1="5" x2="75" y2="10" stroke="#000000" stroke-width="3" stroke-linecap="round"/>
                <line x1="95" y1="25" x2="90" y2="25" stroke="#000000" stroke-width="3" stroke-linecap="round"/>
                <line x1="89" y1="11" x2="85" y2="15" stroke="#000000" stroke-width="3" stroke-linecap="round"/>
                <line x1="89" y1="39" x2="85" y2="35" stroke="#000000" stroke-width="3" stroke-linecap="round"/>
                <!-- Heat waves going to package -->
                <path d="M58,30 Q55,35 58,40" fill="none" stroke="#000000" stroke-width="2"/>
                <path d="M52,28 Q49,35 52,42" fill="none" stroke="#000000" stroke-width="2"/>
                <path d="M46,26 Q43,35 46,44" fill="none" stroke="#000000" stroke-width="2"/>
                <!-- Package box -->
                <rect x="12" y="45" width="40" height="40" fill="none" stroke="#000000" stroke-width="4" rx="2"/>
                <!-- Away arrow -->
                <path d="M60,65 L75,65 L70,58 M75,65 L70,72" fill="none" stroke="#000000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            </symbol>

            <!-- 
                ISO 7000-0628: DO NOT STACK / ÜST ÜSTE KOYMAYIN
                Two boxes with prohibition symbol
            -->
            <symbol id="icon-nostack" viewBox="0 0 100 100">
                <!-- Bottom box -->
                <rect x="20" y="55" width="40" height="30" fill="none" stroke="#000000" stroke-width="4" rx="2"/>
                <!-- Top box (crossed out) -->
                <rect x="25" y="25" width="30" height="25" fill="none" stroke="#000000" stroke-width="3" rx="2" stroke-dasharray="4,2"/>
                <!-- Prohibition X over top box -->
                <line x1="25" y1="25" x2="55" y2="50" stroke="#000000" stroke-width="4" stroke-linecap="round"/>
                <line x1="55" y1="25" x2="25" y2="50" stroke="#000000" stroke-width="4" stroke-linecap="round"/>
                <!-- Down arrow showing weight -->
                <path d="M75,30 L75,70 L65,60 M75,70 L85,60" fill="none" stroke="#000000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            </symbol>

            <!-- 
                ISO 7000-0631: HANDLE WITH CARE / DİKKATLE TAŞIYIN
                Two hands cradling symbol
            -->
            <symbol id="icon-care" viewBox="0 0 100 100">
                <!-- Left hand outline -->
                <path d="M15,60 Q10,50 15,40 L25,40 L25,30 Q25,25 30,25 L35,25 Q40,25 40,30 L40,55" 
                      fill="none" stroke="#000000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <!-- Right hand outline (mirrored) -->
                <path d="M85,60 Q90,50 85,40 L75,40 L75,30 Q75,25 70,25 L65,25 Q60,25 60,30 L60,55" 
                      fill="none" stroke="#000000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <!-- Package between hands -->
                <rect x="35" y="45" width="30" height="25" fill="none" stroke="#000000" stroke-width="4" rx="2"/>
                <!-- Care indication (sparkle/attention) -->
                <circle cx="50" cy="35" r="3" fill="#000000"/>
                <line x1="50" y1="25" x2="50" y2="30" stroke="#000000" stroke-width="2"/>
                <line x1="42" y1="35" x2="37" y2="35" stroke="#000000" stroke-width="2"/>
                <line x1="58" y1="35" x2="63" y2="35" stroke="#000000" stroke-width="2"/>
            </symbol>

            <!-- 
                ISO 7000-0632: STACKING LIMIT BY WEIGHT / AĞIRLIK LİMİTİ
                Boxes with max weight indicator
            -->
            <symbol id="icon-stacklimit" viewBox="0 0 100 100">
                <!-- Bottom box -->
                <rect x="25" y="60" width="50" height="30" fill="none" stroke="#000000" stroke-width="4" rx="2"/>
                <!-- Top box -->
                <rect x="30" y="32" width="40" height="25" fill="none" stroke="#000000" stroke-width="3" rx="2"/>
                <!-- Weight indicator n kg -->
                <text x="50" y="80" text-anchor="middle" font-size="14" font-weight="bold" font-family="Montserrat" fill="#000000">kg</text>
                <!-- Max line with arrows -->
                <line x1="15" y1="32" x2="15" y2="90" stroke="#000000" stroke-width="3"/>
                <path d="M10,37 L15,32 L20,37" fill="none" stroke="#000000" stroke-width="3" stroke-linejoin="round"/>
                <path d="M10,85 L15,90 L20,85" fill="none" stroke="#000000" stroke-width="3" stroke-linejoin="round"/>
            </symbol>

            <!-- 
                ISO 7000-0629: DO NOT ROLL / YUVARLAMA
                Circular prohibition with rolling arrows
            -->
            <symbol id="icon-noroll" viewBox="0 0 100 100">
                <!-- Prohibition circle -->
                <circle cx="50" cy="50" r="42" fill="none" stroke="#000000" stroke-width="5"/>
                <!-- Barrel/cylinder shape -->
                <ellipse cx="50" cy="35" rx="20" ry="8" fill="none" stroke="#000000" stroke-width="3"/>
                <ellipse cx="50" cy="65" rx="20" ry="8" fill="none" stroke="#000000" stroke-width="3"/>
                <line x1="30" y1="35" x2="30" y2="65" stroke="#000000" stroke-width="3"/>
                <line x1="70" y1="35" x2="70" y2="65" stroke="#000000" stroke-width="3"/>
                <!-- Prohibition diagonal line -->
                <line x1="20" y1="20" x2="80" y2="80" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
            </symbol>

            <!-- 
                ISO 7000-0624: CENTER OF GRAVITY / AĞIRLIK MERKEZİ
                Crosshair indicating center of mass
            -->
            <symbol id="icon-cog" viewBox="0 0 100 100">
                <!-- Outer circle -->
                <circle cx="50" cy="50" r="35" fill="none" stroke="#000000" stroke-width="4"/>
                <!-- Inner filled circle -->
                <circle cx="50" cy="50" r="8" fill="#000000"/>
                <!-- Crosshair lines extending beyond circle -->
                <line x1="50" y1="5" x2="50" y2="15" stroke="#000000" stroke-width="4"/>
                <line x1="50" y1="85" x2="50" y2="95" stroke="#000000" stroke-width="4"/>
                <line x1="5" y1="50" x2="15" y2="50" stroke="#000000" stroke-width="4"/>
                <line x1="85" y1="50" x2="95" y2="50" stroke="#000000" stroke-width="4"/>
            </symbol>

            <!-- 
                ISO 7000-0625: SLING HERE / KALDIRMA NOKTASI
                Chain/sling attachment point indicator
            -->
            <symbol id="icon-sling" viewBox="0 0 100 100">
                <!-- Package box -->
                <rect x="15" y="40" width="70" height="45" fill="none" stroke="#000000" stroke-width="4" rx="2"/>
                <!-- Sling chains going up -->
                <path d="M35,40 L35,20 L50,8 L65,20 L65,40" fill="none" stroke="#000000" stroke-width="4" stroke-linejoin="round"/>
                <!-- Hook at top -->
                <circle cx="50" cy="12" r="6" fill="none" stroke="#000000" stroke-width="3"/>
                <!-- Attachment points on box -->
                <circle cx="35" cy="40" r="4" fill="#000000"/>
                <circle cx="65" cy="40" r="4" fill="#000000"/>
            </symbol>

            <!-- 
                ISO 7000-0619: CLAMP HERE / MENGENE NOKTASI  
                Forklift clamp position indicator
            -->
            <symbol id="icon-clamp" viewBox="0 0 100 100">
                <!-- Package box -->
                <rect x="25" y="25" width="50" height="60" fill="none" stroke="#000000" stroke-width="4" rx="2"/>
                <!-- Left clamp arrow -->
                <path d="M8,55 L22,55" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
                <path d="M15,48 L22,55 L15,62" fill="none" stroke="#000000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <!-- Right clamp arrow -->
                <path d="M92,55 L78,55" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
                <path d="M85,48 L78,55 L85,62" fill="none" stroke="#000000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <!-- Clamp position lines on box -->
                <line x1="25" y1="45" x2="25" y2="65" stroke="#000000" stroke-width="6"/>
                <line x1="75" y1="45" x2="75" y2="65" stroke="#000000" stroke-width="6"/>
            </symbol>

            <!-- 
                RECYCLING SYMBOL / GERİ DÖNÜŞÜM
                Standard recycling arrows
            -->
            <symbol id="icon-recycle" viewBox="0 0 100 100">
                <path d="M50,15 L65,40 L55,40 L55,55 L45,55 L45,40 L35,40 Z" fill="#000000" transform="rotate(0,50,50)"/>
                <path d="M50,15 L65,40 L55,40 L55,55 L45,55 L45,40 L35,40 Z" fill="#000000" transform="rotate(120,50,50)"/>
                <path d="M50,15 L65,40 L55,40 L55,55 L45,55 L45,40 L35,40 Z" fill="#000000" transform="rotate(240,50,50)"/>
            </symbol>


            <!-- 
                MEASUREMENT SYMBOLS (Shipping marks style)
                Weight / Volume / Volumetric Weight (for international freight documentation)
            -->
            <symbol id="icon-weight" viewBox="0 0 100 100">
                <!-- Top ring -->
                <circle cx="50" cy="20" r="10" fill="none" stroke="#000000" stroke-width="6"/>
                <!-- Body -->
                <path d="M35,30 L65,30 L76,90 L24,90 Z" fill="none" stroke="#000000" stroke-width="6" stroke-linejoin="round"/>
                <!-- Inner highlights -->
                <line x1="40" y1="55" x2="60" y2="55" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
                <line x1="44" y1="70" x2="56" y2="70" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
            </symbol>

            <symbol id="icon-cbm" viewBox="0 0 100 100">
                <!-- Cube outline -->
                <path d="M20,35 L50,20 L80,35 L80,75 L50,90 L20,75 Z" fill="none" stroke="#000000" stroke-width="6" stroke-linejoin="round"/>
                <!-- Inner edges -->
                <line x1="50" y1="20" x2="50" y2="90" stroke="#000000" stroke-width="4"/>
                <line x1="20" y1="35" x2="50" y2="50" stroke="#000000" stroke-width="4"/>
                <line x1="80" y1="35" x2="50" y2="50" stroke="#000000" stroke-width="4"/>
            </symbol>

            <symbol id="icon-volwt" viewBox="0 0 100 100">
                <!-- Box -->
                <rect x="30" y="30" width="40" height="40" fill="none" stroke="#000000" stroke-width="6" stroke-linejoin="round"/>
                <!-- Vertical dimension arrows -->
                <line x1="20" y1="30" x2="20" y2="70" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
                <path d="M14,38 L20,30 L26,38" fill="none" stroke="#000000" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M14,62 L20,70 L26,62" fill="none" stroke="#000000" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                <!-- Horizontal dimension arrows -->
                <line x1="30" y1="80" x2="70" y2="80" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
                <path d="M38,74 L30,80 L38,86" fill="none" stroke="#000000" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M62,74 L70,80 L62,86" fill="none" stroke="#000000" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
            </symbol>

        </defs>
    </svg>

    <!-- ═══════════════════════════════════════════════════════════════
         JAVASCRIPT
    ═══════════════════════════════════════════════════════════════ -->
    <script>
        // ═══════════════════════════════════════════════════════════════
        // INTERNATIONALIZATION (i18n) SYSTEM
        // ═══════════════════════════════════════════════════════════════
        const translations = {
            tr: {
                // Header
                appVersion: 'PRO v7.0',
                templates: 'Şablonlar',
                help: 'Yardım',
                
                // Sidebar
                labelTheme: 'Etiket Teması',
                logisticSymbols: 'Lojistik Sembolleri (ISO 780:2015)',
                addressInfo: 'Adres Bilgileri',
                sender: 'Gönderen',
                receiver: 'Alıcı (İlk Satır Vurgulu)',
                prefix: 'Önek',
                startNo: 'Başlangıç No',
                codeType: 'Kod Tipi',
                barcode: 'Barkod',
                qrCode: 'QR Kod',
                
                // Icons
                fragile: 'Kırılabilir',
                thisWayUp: 'Bu Yön',
                keepDry: 'Kuru Tut',
                noKnife: 'Bıçak Yok',
                protectHeat: 'Isıdan Koru',
                noStack: 'Üst Üste Yok',
                handleCare: 'Dikkatli Taşı',
                slingPoint: 'Kaldırma Nok.',
                
                // Icon labels for print
                iconFragile: 'KIRILABİLİR',
                iconUp: 'BU YÖN YUKARI',
                iconDry: 'KURU TUT',
                iconKnife: 'BIÇAK KULLANMA',
                iconHeat: 'ISIDAN KORU',
                iconNoStack: 'ÜSTÜNE KOYMA',
                iconCare: 'DİKKATLİ TAŞI',
                iconSling: 'KALDIRMA NOK.',
                
                // Buttons
                generateLabels: 'ETİKETLERİ OLUŞTUR',
                downloadPdf: 'PDF İndir',
                print: 'Yazdır',
                bulkAdd: 'Toplu Ekle',
                add: 'Ekle',
                cancel: 'İptal',
                apply: 'Uygula',
                save: 'Kaydet',
                
                // Product List
                productList: 'Ürün Listesi',
                productListDesc: 'Paketleri sürükleyerek sıralayın, içerikleri düzenleyin.',
                product: 'Ürün',
                package: 'Paket',
                page: 'Sayfa',
                drag: 'Sürükle',
                delete: 'Sil',
                productNamePlaceholder: 'Ürün adını girin...',
                
                // Empty State
                noProducts: 'Henüz ürün eklenmedi',
                addFirstProduct: 'İlk Ürünü Ekle',
                
                // Preview
                labelPreview: 'Etiket Önizleme',
                previewHint: 'Önizleme için "Etiketleri Oluştur" butonuna tıklayın',
                
                // Modals
                bulkAddTitle: 'Toplu Ürün Ekle',
                bulkAddHint: 'Format Örnekleri:',
                bulkAddPlaceholder: 'Her satıra bir ürün yazın...',
                helpTitle: 'Yardım & Kısayollar',
                keyboardShortcuts: 'Klavye Kısayolları',
                features: 'Özellikler',
                saveTemplate: 'Şablon Kaydet',
                templateName: 'Şablon Adı',
                templateNamePlaceholder: 'Örn: İhracat Şablonu',
                saveAsTemplate: 'Şablon Olarak Kaydet',
                noTemplates: 'Kayıtlı şablon yok',
                
                // Label Print
                shippingLabel: 'SEVKİYAT ETİKETİ',
                senderLabel: 'GÖNDEREN',
                receiverLabel: 'ALICI',
                contentInfo: 'İÇERİK BİLGİSİ',
                packageNo: 'PAKET NO',
                pageOf: 'Sayfa',
                cutLine: '✂ KESİM HATTI',
                
                // Toasts
                saved: 'Kaydedildi!',
                templateSaved: 'Şablon kaydedildi!',
                templateLoaded: 'şablonu yüklendi!',
                templateDeleted: 'Şablon silindi!',
                labelsGenerated: 'etiket oluşturuldu!',
                pdfDownloaded: 'PDF indirildi!',
                pdfError: 'PDF oluşturulurken hata!',
                addProductsFirst: 'Önce ürün ekleyin!',
                emptyProductNames: 'Boş ürün adları var!',
                textEmpty: 'Metin boş!',
                templateNameRequired: 'Şablon adı gerekli!',
                productsAdded: 'ürün eklendi!',
                confirmDeleteTemplate: 'Bu şablonu silmek istediğinize emin misiniz?',
                
                // Loading
                creatingPdf: 'PDF oluşturuluyor...',
                
                // New features
                labelSettings: 'Etiket Ayarları',
                labelSize: 'Etiket Boyutu',
                customLogo: 'Özel Logo',
                uploadLogo: 'Logo Yükle',
                removeLogo: 'Logoyu Kaldır',
                showDimensions: 'Ölçü/Ağırlık Göster',
                weight: 'Ağırlık (kg)',
                dimensions: 'Boyut (cm)',
                desi: 'Desi',
                totalWeight: 'Toplam Ağırlık',
                totalDesi: 'Toplam Desi',
                multiReceiver: 'Çoklu Alıcı',
                addReceiver: 'Alıcı Ekle',
                receiverList: 'Alıcı Listesi',
                
                // Label sizes
                sizeA4Half: 'A4 Yarım (210x148mm)',
                sizeA5: 'A5 (210x148mm)',
                sizeThermal100x150: 'Termal 100x150mm',
                sizeThermal100x70: 'Termal 100x70mm',
                
                // Default addresses (boş - kullanıcı kendi bilgilerini girecek)
                defaultSender: ``,
                defaultReceiver: ``
            },
            en: {
                // Header
                appVersion: 'PRO v7.0',
                templates: 'Templates',
                help: 'Help',
                
                // Sidebar
                labelTheme: 'Label Theme',
                logisticSymbols: 'Logistic Symbols (ISO 780:2015)',
                addressInfo: 'Address Information',
                sender: 'Sender',
                receiver: 'Receiver (First Line Bold)',
                prefix: 'Prefix',
                startNo: 'Start No',
                codeType: 'Code Type',
                barcode: 'Barcode',
                qrCode: 'QR Code',
                
                // Icons
                fragile: 'Fragile',
                thisWayUp: 'This Way Up',
                keepDry: 'Keep Dry',
                noKnife: 'No Blades',
                protectHeat: 'Protect Heat',
                noStack: 'Do Not Stack',
                handleCare: 'Handle Care',
                slingPoint: 'Sling Here',
                
                // Icon labels for print
                iconFragile: 'FRAGILE',
                iconUp: 'THIS SIDE UP',
                iconDry: 'KEEP DRY',
                iconKnife: 'NO BLADES',
                iconHeat: 'PROTECT FROM HEAT',
                iconNoStack: 'DO NOT STACK',
                iconCare: 'HANDLE WITH CARE',
                iconSling: 'SLING HERE',
                
                // Buttons
                generateLabels: 'GENERATE LABELS',
                downloadPdf: 'Download PDF',
                print: 'Print',
                bulkAdd: 'Bulk Add',
                add: 'Add',
                cancel: 'Cancel',
                apply: 'Apply',
                save: 'Save',
                
                // Product List
                productList: 'Product List',
                productListDesc: 'Drag to reorder packages, edit contents.',
                product: 'Product',
                package: 'Package',
                page: 'Page',
                drag: 'Drag',
                delete: 'Delete',
                productNamePlaceholder: 'Enter product name...',
                
                // Empty State
                noProducts: 'No products added yet',
                addFirstProduct: 'Add First Product',
                
                // Preview
                labelPreview: 'Label Preview',
                previewHint: 'Click "Generate Labels" to preview',
                
                // Modals
                bulkAddTitle: 'Bulk Add Products',
                bulkAddHint: 'Format Examples:',
                bulkAddPlaceholder: 'Enter one product per line...',
                helpTitle: 'Help & Shortcuts',
                keyboardShortcuts: 'Keyboard Shortcuts',
                features: 'Features',
                saveTemplate: 'Save Template',
                templateName: 'Template Name',
                templateNamePlaceholder: 'E.g.: Export Template',
                saveAsTemplate: 'Save as Template',
                noTemplates: 'No saved templates',
                
                // Label Print
                shippingLabel: 'SHIPPING LABEL',
                senderLabel: 'FROM',
                receiverLabel: 'TO',
                contentInfo: 'CONTENT INFORMATION',
                packageNo: 'PACKAGE NO',
                pageOf: 'Page',
                cutLine: '✂ CUT LINE',
                
                // Toasts
                saved: 'Saved!',
                templateSaved: 'Template saved!',
                templateLoaded: 'template loaded!',
                templateDeleted: 'Template deleted!',
                labelsGenerated: 'labels generated!',
                pdfDownloaded: 'PDF downloaded!',
                pdfError: 'Error creating PDF!',
                addProductsFirst: 'Add products first!',
                emptyProductNames: 'Empty product names exist!',
                textEmpty: 'Text is empty!',
                templateNameRequired: 'Template name required!',
                productsAdded: 'products added!',
                confirmDeleteTemplate: 'Are you sure you want to delete this template?',
                
                // Loading
                creatingPdf: 'Creating PDF...',
                
                // New features
                labelSettings: 'Label Settings',
                labelSize: 'Label Size',
                customLogo: 'Custom Logo',
                uploadLogo: 'Upload Logo',
                removeLogo: 'Remove Logo',
                showDimensions: 'Show Dimensions/Weight',
                weight: 'Weight (kg)',
                dimensions: 'Dimensions (cm)',
                desi: 'Vol. Weight',
                totalWeight: 'Total Weight',
                totalDesi: 'Total Vol. Weight',
                multiReceiver: 'Multiple Receivers',
                addReceiver: 'Add Receiver',
                receiverList: 'Receiver List',
                
                // Label sizes
                sizeA4Half: 'A4 Half (210x148mm)',
                sizeA5: 'A5 (210x148mm)',
                sizeThermal100x150: 'Thermal 100x150mm',
                sizeThermal100x70: 'Thermal 100x70mm',
                
                // Default addresses (empty - user will enter their own info)
                defaultSender: ``,
                defaultReceiver: ``
            }
        };
        
        // Current language
        let currentLang = 'tr';
        
        // Get translation
        function t(key) {
            return translations[currentLang][key] || translations['tr'][key] || key;
        }
        
        // ═══════════════════════════════════════════════════════════════
        // STATE MANAGEMENT
        // ═══════════════════════════════════════════════════════════════
        const APP_VERSION = '7.0';
        const STORAGE_KEY = 'gasell_pro_v8_data'; // v8: Temiz başlangıç versiyonu
        const TEMPLATES_KEY = 'gasell_pro_v8_templates';
        
        let state = {
            products: [], // Boş başla - kullanıcı kendi ekleyecek
            receivers: [], // Çoklu alıcı listesi
            settings: {
                theme: '#BE1622',
                darkMode: false,
                barcodeType: 'barcode',
                language: 'tr',
                labelSize: 'a4-landscape', // a4-landscape, a4-half, a5, thermal-100x150, thermal-100x70
                customLogo: null, // Base64 encoded logo
                showDimensions: false,
                icons: { 
                    fragile: true, 
                    up: true, 
                    dry: false, 
                    knife: true,
                    heat: false,
                    nostack: false,
                    care: false,
                    sling: false
                }
            }
        };
        
        let history = { past: [], future: [] };
        let nextId = 100;
        let sortableInstance = null;

        // ═══════════════════════════════════════════════════════════════
        // INITIALIZATION
        // ═══════════════════════════════════════════════════════════════
        document.addEventListener('DOMContentLoaded', () => {
            loadFromStorage();
            
            // Set language from storage
            currentLang = state.settings.language || 'tr';
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('lang-' + currentLang).classList.add('active');
            
            initSortable();
            renderProducts();
            updateStats();
            applyThemeColor(state.settings.theme);
            if (state.settings.darkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.getElementById('themeIcon').classList.replace('fa-moon', 'fa-sun');
            }
            
            // Load label size
            if (state.settings.labelSize) {
                document.getElementById('labelSizeSelect').value = state.settings.labelSize;
            }
            
            // Load custom logo
            updateLogoPreview();
            
            // Load dimensions toggle
            if (state.settings.showDimensions) {
                document.getElementById('btn-dimensions').classList.add('active');
            }
            
            loadTemplates();
            setupKeyboardShortcuts();
            setupAutoSave();
            setupAutoPrefix(); // Otomatik barkod önek oluşturma
            registerServiceWorker();
            
            // Update UI language after all elements are ready
            setTimeout(() => updateUILanguage(), 100);
        });
        
        // Service Worker Registration for PWA
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                // Create inline service worker
                const swCode = `
                    const CACHE_NAME = 'gasell-pro-v7.0';
                    const urlsToCache = [
                        './',
                        'https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;600&display=swap',
                        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css'
                    ];
                    
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl).then(reg => {
                    console.log('PWA: Service Worker registered');
                }).catch(err => {
                    console.log('PWA: Service Worker registration failed (expected in file:// protocol)');
                });
            }
        }

        // ═══════════════════════════════════════════════════════════════
        // STORAGE
        // ═══════════════════════════════════════════════════════════════
        function saveToStorage() {
            // Sadece ayarları kaydet, adres ve ürün bilgilerini kaydetme
            const data = {
                version: APP_VERSION,
                state: {
                    settings: state.settings,
                    products: [] // Ürünleri kaydetme
                }
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }
        
        function loadFromStorage() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    
                    // SADECE AYARLARI YÜKLE (tema, dil, ikon seçimleri vs.)
                    // Adres ve ürün bilgileri YÜKLENMİYOR - her seferinde temiz başla
                    if (data.state && data.state.settings) {
                        state.settings = { ...state.settings, ...data.state.settings };
                        
                        // Label size kontrolü
                        const validSizes = ['a4-landscape', 'a4-half', 'a5', 'thermal-100x150', 'thermal-100x70'];
                        if (!validSizes.includes(state.settings.labelSize)) {
                            state.settings.labelSize = 'a4-landscape';
                        }
                    }
                    
                    // Ürünler ve adresler YÜKLENMİYOR - temiz başla
                    // state.products boş kalacak
                    // Form alanları boş kalacak
                    
                    Object.keys(state.settings.icons).forEach(key => {
                        const btn = document.getElementById('btn-' + key);
                        if (btn) btn.classList.toggle('active', state.settings.icons[key]);
                    });
                    
                    setBarcodeType(state.settings.barcodeType, false);
                } catch (e) {
                    console.error('Load error:', e);
                }
            }
        }
        
        // ═══════════════════════════════════════════════════════════════
        // OTOMATİK BARKOD ÖNEK OLUŞTURMA
        // Format: TAY-GSL-251225-001
        // ═══════════════════════════════════════════════════════════════
        function generateAutoPrefix() {
            const receiverCompany = document.getElementById('receiverCompany').value.trim();
            const previewEl = document.getElementById('autoCodePreview');
            
            if (!receiverCompany) {
                document.getElementById('codePrefix').value = '';
                if (previewEl) {
                    previewEl.innerHTML = '<span class="code-placeholder">Alıcı firma adını girin...</span>';
                }
                return;
            }
            
            // Firma adından kısaltma oluştur (max 3 karakter)
            const words = receiverCompany.toUpperCase()
                .replace(/[^A-ZÇĞİÖŞÜ0-9\s]/gi, '')
                .split(/\s+/)
                .filter(w => w.length > 0);
            
            let companyCode = '';
            if (words.length === 1) {
                companyCode = words[0].substring(0, 3);
            } else if (words.length === 2) {
                companyCode = words[0].substring(0, 2) + words[1].substring(0, 1);
            } else {
                companyCode = words.slice(0, 3).map(w => w[0]).join('');
            }
            
            // Türkçe karakterleri değiştir
            companyCode = companyCode
                .replace(/Ç/g, 'C')
                .replace(/Ğ/g, 'G')
                .replace(/İ/g, 'I')
                .replace(/Ö/g, 'O')
                .replace(/Ş/g, 'S')
                .replace(/Ü/g, 'U');
            
            // Bugünün tarihi (GGAAYY formatı)
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = String(today.getFullYear()).slice(-2);
            const dateStr = day + month + year;
            
            // Final önek: FIRMA-GSL-TARIH-
            const finalPrefix = companyCode + '-GSL-' + dateStr + '-';
            document.getElementById('codePrefix').value = finalPrefix;
            
            // Önizleme güncelle
            if (previewEl) {
                previewEl.innerHTML = `<span style="color: var(--theme-color);">${finalPrefix}</span><span style="color: var(--text-muted);">001</span>`;
            }
        }
        
        function setupAutoPrefix() {
            // Alıcı firma adı değiştiğinde otomatik önek oluştur
            const receiverCompany = document.getElementById('receiverCompany');
            if (receiverCompany) {
                receiverCompany.addEventListener('input', generateAutoPrefix);
                receiverCompany.addEventListener('blur', generateAutoPrefix);
            }
        }
        
        function setupAutoSave() {
            let saveTimeout;
            const autoSave = () => {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => saveToStorage(), 500);
            };
            
            document.querySelectorAll('#senderCompany, #senderPerson, #senderPhone, #senderStreet, #senderDistrict, #senderCity, #receiverCompany, #receiverPerson, #receiverPhone, #receiverStreet, #receiverDistrict, #receiverCity').forEach(el => {
                if (el) el.addEventListener('input', autoSave);
            });
        }

        // ═══════════════════════════════════════════════════════════════
        // UNDO/REDO
        // ═══════════════════════════════════════════════════════════════
        function saveHistory() {
            history.past.push(JSON.stringify(state.products));
            if (history.past.length > 50) history.past.shift();
            history.future = [];
            updateUndoRedoButtons();
        }
        
        function undoAction() {
            if (history.past.length === 0) return;
            history.future.push(JSON.stringify(state.products));
            state.products = JSON.parse(history.past.pop());
            renderProducts();
            updateStats();
            updateUndoRedoButtons();
            saveToStorage();
        }
        
        function redoAction() {
            if (history.future.length === 0) return;
            history.past.push(JSON.stringify(state.products));
            state.products = JSON.parse(history.future.pop());
            renderProducts();
            updateStats();
            updateUndoRedoButtons();
            saveToStorage();
        }
        
        function updateUndoRedoButtons() {
            document.getElementById('undoBtn').disabled = history.past.length === 0;
            document.getElementById('redoBtn').disabled = history.future.length === 0;
        }

        // ═══════════════════════════════════════════════════════════════
        // KEYBOARD SHORTCUTS
        // ═══════════════════════════════════════════════════════════════
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.target.matches('input, textarea')) return;
                
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key.toLowerCase()) {
                        case 'p':
                            e.preventDefault();
                            generateLabels();
                            setTimeout(() => printLabels(), 500);
                            break;
                        case 's':
                            e.preventDefault();
                            saveToStorage();
                            showToast('Kaydedildi!', 'success');
                            break;
                        case 'z':
                            e.preventDefault();
                            if (e.shiftKey) redoAction();
                            else undoAction();
                            break;
                        case 'y':
                            e.preventDefault();
                            redoAction();
                            break;
                        case 'n':
                            e.preventDefault();
                            addProduct();
                            break;
                    }
                }
            });
        }

        // ═══════════════════════════════════════════════════════════════
        // THEME & SETTINGS
        // ═══════════════════════════════════════════════════════════════
        function setTheme(color, element) {
            state.settings.theme = color;
            applyThemeColor(color);
            
            document.querySelectorAll('.color-option').forEach(el => el.classList.remove('active'));
            if (element) element.classList.add('active');
            
            saveToStorage();
        }
        
        function applyThemeColor(color) {
            document.documentElement.style.setProperty('--theme-color', color);
            
            const hex = color.replace('#', '');
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            document.documentElement.style.setProperty('--theme-color-rgb', `${r}, ${g}, ${b}`);
            
            const lightColor = `rgba(${r}, ${g}, ${b}, 0.1)`;
            document.documentElement.style.setProperty('--theme-light', lightColor);
            
            const darkR = Math.max(0, r - 40);
            const darkG = Math.max(0, g - 40);
            const darkB = Math.max(0, b - 40);
            document.documentElement.style.setProperty('--theme-dark', `rgb(${darkR}, ${darkG}, ${darkB})`);
        }
        
        function toggleTheme() {
            state.settings.darkMode = !state.settings.darkMode;
            document.documentElement.setAttribute('data-theme', state.settings.darkMode ? 'dark' : '');
            const icon = document.getElementById('themeIcon');
            icon.classList.toggle('fa-moon', !state.settings.darkMode);
            icon.classList.toggle('fa-sun', state.settings.darkMode);
            saveToStorage();
        }
        
        function setLanguage(lang) {
            currentLang = lang;
            state.settings.language = lang;
            
            // Update language buttons
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('lang-' + lang).classList.add('active');
            
            // Update all UI elements
            updateUILanguage();
            saveToStorage();
        }
        
        function updateUILanguage() {
            // Helper function for safe element selection
            const setText = (selector, text) => {
                const el = document.querySelector(selector);
                if (el) el.textContent = text;
            };
            const setHTML = (selector, html) => {
                const el = document.querySelector(selector);
                if (el) el.innerHTML = html;
            };
            const setById = (id, html) => {
                const el = document.getElementById(id);
                if (el) el.innerHTML = html;
            };
            
            // Sidebar labels
            setText('[data-section="labelTheme"]', t('labelTheme'));
            setText('[data-section="logisticSymbols"]', t('logisticSymbols'));
            setText('[data-section="addressInfo"]', t('addressInfo'));
            
            // Form labels
            setText('[data-label="sender"]', t('sender'));
            setText('[data-label="receiver"]', t('receiver'));
            setText('[data-label="codeType"]', t('codeType'));
            
            // Buttons
            setHTML('[data-btn="generateLabels"]', `<i class="fa-solid fa-print"></i> ${t('generateLabels')}`);
            setHTML('[data-btn="downloadPdf"]', `<i class="fa-solid fa-file-pdf"></i> ${t('downloadPdf')}`);
            setHTML('[data-btn="print"]', `<i class="fa-solid fa-print"></i> ${t('print')}`);
            setHTML('[data-btn="bulkAdd"]', `<i class="fa-solid fa-paste"></i> ${t('bulkAdd')}`);
            setHTML('[data-btn="add"]', `<i class="fa-solid fa-plus"></i> ${t('add')}`);
            
            // Icon checkboxes
            setText('[data-icon="fragile"] span', t('fragile'));
            setText('[data-icon="up"] span', t('thisWayUp'));
            setText('[data-icon="dry"] span', t('keepDry'));
            setText('[data-icon="knife"] span', t('noKnife'));
            setText('[data-icon="heat"] span', t('protectHeat'));
            setText('[data-icon="nostack"] span', t('noStack'));
            setText('[data-icon="care"] span', t('handleCare'));
            setText('[data-icon="sling"] span', t('slingPoint'));
            
            // Barcode buttons
            setById('btn-barcode', `<i class="fa-solid fa-barcode"></i> ${t('barcode')}`);
            setById('btn-qr', `<i class="fa-solid fa-qrcode"></i> ${t('qrCode')}`);
            
            // Restore active state for barcode buttons
            const barcodeBtn = document.getElementById('btn-barcode');
            const qrBtn = document.getElementById('btn-qr');
            if (barcodeBtn) barcodeBtn.classList.toggle('active', state.settings.barcodeType === 'barcode');
            if (qrBtn) qrBtn.classList.toggle('active', state.settings.barcodeType === 'qr');
            
            // Product list header
            setText('[data-text="productList"]', t('productList'));
            setText('[data-text="productListDesc"]', t('productListDesc'));
            
            // Stats
            setText('[data-stat="product"]', t('product'));
            setText('[data-stat="package"]', t('package'));
            setText('[data-stat="page"]', t('page'));
            
            // Empty state
            setText('[data-text="noProducts"]', t('noProducts'));
            setHTML('[data-btn="addFirst"]', `<i class="fa-solid fa-plus"></i> ${t('addFirstProduct')}`);
            
            // Preview
            setHTML('[data-text="labelPreview"]', `<i class="fa-solid fa-eye"></i>${t('labelPreview')}`);
            setText('[data-text="previewHint"]', t('previewHint'));
            
            // Modals
            document.querySelector('[data-modal="bulkTitle"]').textContent = t('bulkAddTitle');
            document.querySelector('[data-modal="bulkHint"]').innerHTML = `<i class="fa-solid fa-lightbulb"></i> ${t('bulkAddHint')}`;
            document.getElementById('bulkText').placeholder = t('bulkAddPlaceholder');
            document.querySelector('[data-modal="bulkCancel"]').textContent = t('cancel');
            document.querySelector('[data-modal="bulkApply"]').innerHTML = `<i class="fa-solid fa-check"></i> ${t('apply')}`;
            
            document.querySelector('[data-modal="helpTitle"]').textContent = t('helpTitle');
            document.querySelector('[data-modal="shortcuts"]').textContent = t('keyboardShortcuts');
            document.querySelector('[data-modal="features"]').textContent = t('features');
            
            document.querySelector('[data-modal="templateTitle"]').textContent = t('saveTemplate');
            document.querySelector('[data-modal="templateLabel"]').textContent = t('templateName');
            document.getElementById('templateName').placeholder = t('templateNamePlaceholder');
            document.querySelector('[data-modal="templateCancel"]').textContent = t('cancel');
            document.querySelector('[data-modal="templateSave"]').innerHTML = `<i class="fa-solid fa-save"></i> ${t('save')}`;
            
            // Loading
            document.querySelector('.loading-text').textContent = t('creatingPdf');
            
            // Label settings section
            const labelSettingsSection = document.querySelector('[data-section="labelSettings"]');
            if (labelSettingsSection) labelSettingsSection.textContent = t('labelSettings');
            
            const labelSizeLabel = document.querySelector('[data-label="labelSize"]');
            if (labelSizeLabel) labelSizeLabel.textContent = t('labelSize');
            
            const customLogoLabel = document.querySelector('[data-label="customLogo"]');
            if (customLogoLabel) customLogoLabel.textContent = t('customLogo');
            
            const uploadLogoLabel = document.querySelector('[data-label="uploadLogo"]');
            if (uploadLogoLabel) uploadLogoLabel.textContent = t('uploadLogo');
            
            const showDimensionsLabel = document.querySelector('[data-label="showDimensions"]');
            if (showDimensionsLabel) showDimensionsLabel.textContent = t('showDimensions');
            
            // Re-render products with updated placeholders
            renderProducts();
        }
        
        function toggleIcon(key) {
            state.settings.icons[key] = !state.settings.icons[key];
            const btn = document.getElementById('btn-' + key);
            btn.classList.toggle('active', state.settings.icons[key]);
            btn.setAttribute('aria-checked', state.settings.icons[key]);
            saveToStorage();
        }
        
        function setBarcodeType(type, save = true) {
            state.settings.barcodeType = type;
            document.getElementById('btn-barcode').classList.toggle('active', type === 'barcode');
            document.getElementById('btn-qr').classList.toggle('active', type === 'qr');
            if (save) saveToStorage();
        }
        
        // Logo Upload Functions
        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showToast(currentLang === 'tr' ? 'Sadece resim dosyaları!' : 'Only image files!', 'warning');
                return;
            }
            
            if (file.size > 2 * 1024 * 1024) {
                showToast(currentLang === 'tr' ? 'Dosya 2MB\'dan küçük olmalı!' : 'File must be under 2MB!', 'warning');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                state.settings.customLogo = e.target.result;
                updateLogoPreview();
                saveToStorage();
                showToast(currentLang === 'tr' ? 'Logo yüklendi!' : 'Logo uploaded!', 'success');
            };
            reader.readAsDataURL(file);
        }
        
        function updateLogoPreview() {
            const preview = document.getElementById('logoPreview');
            const img = document.getElementById('logoPreviewImg');
            const uploadLabel = document.getElementById('logoUploadLabel');
            
            if (state.settings.customLogo) {
                img.src = state.settings.customLogo;
                preview.classList.remove('hidden');
                uploadLabel.classList.add('hidden');
            } else {
                preview.classList.add('hidden');
                uploadLabel.classList.remove('hidden');
            }
        }
        
        function removeLogo() {
            state.settings.customLogo = null;
            document.getElementById('logoInput').value = '';
            updateLogoPreview();
            saveToStorage();
            showToast(currentLang === 'tr' ? 'Logo kaldırıldı!' : 'Logo removed!', 'success');
        }
        
        // Label Size Functions
        function setLabelSize(size) {
            state.settings.labelSize = size;
            document.getElementById('labelSizeSelect').value = size;
            saveToStorage();
            
            // Eğer etiketler zaten oluşturulmuşsa yeniden oluştur
            if (document.getElementById('printArea').children.length > 0) {
                generateLabels();
            }
        }
        
        // Dimensions Toggle
        function toggleDimensions() {
            state.settings.showDimensions = !state.settings.showDimensions;
            const btn = document.getElementById('btn-dimensions');
            btn.classList.toggle('active', state.settings.showDimensions);
            btn.setAttribute('aria-checked', state.settings.showDimensions);
            renderProducts();
            updateStats();
            saveToStorage();
        }
        
        // Update product dimensions
        function updateProductDimension(id, field, value) {
            const product = state.products.find(p => p.id === id);
            if (product) {
                product[field] = parseFloat(value) || 0;
                updateStats();
                saveToStorage();
            }
        }
        
        // Calculate desi (Volumetric Weight)
        function calculateDesiValue(w, h, d) {
            if (!w || !h || !d) return 0;
            return (w * h * d) / 3000;
        }

        function calculateM3(width, height, depth) {
            if (!width || !height || !depth) return 0;
            // Dimensions are in cm -> m³ conversion
            return (width * height * depth) / 1000000;
        }


        // ═══════════════════════════════════════════════════════════════
        // SORTABLE (Drag & Drop)
        // ═══════════════════════════════════════════════════════════════
        function initSortable() {
            const list = document.getElementById('productList');
            sortableInstance = new Sortable(list, {
                animation: 200,
                handle: '.row-handle',
                ghostClass: 'ghost',
                dragClass: 'dragging',
                onEnd: (evt) => {
                    const item = state.products.splice(evt.oldIndex, 1)[0];
                    state.products.splice(evt.newIndex, 0, item);
                    saveHistory();
                    renderProducts();
                    saveToStorage();
                }
            });
        }

        // ═══════════════════════════════════════════════════════════════
        // PRODUCTS CRUD
        // ═══════════════════════════════════════════════════════════════
        function addProduct() {
            saveHistory();
            state.products.push({ 
                id: nextId++, 
                name: "", 
                count: 1, 
                parts: [""],
                weight: 0,
                width: 0,
                height: 0,
                depth: 0
            });
            renderProducts();
            updateStats();
            saveToStorage();
            
            setTimeout(() => {
                const inputs = document.querySelectorAll('.product-name-input');
                inputs[inputs.length - 1]?.focus();
            }, 100);
        }
        
        function removeProduct(id) {
            saveHistory();
            state.products = state.products.filter(p => p.id !== id);
            renderProducts();
            updateStats();
            saveToStorage();
        }
        
        function updateProductName(id, value) {
            const product = state.products.find(p => p.id === id);
            if (product) {
                product.name = value;
                saveToStorage();
            }
        }
        
        function updatePartName(productId, partIndex, value) {
            const product = state.products.find(p => p.id === productId);
            if (product) {
                product.parts[partIndex] = value;
                saveToStorage();
            }
        }
        
        function changeCount(id, delta) {
            saveHistory();
            const product = state.products.find(p => p.id === id);
            if (!product) return;
            
            let newCount = product.count + delta;
            if (newCount < 1) newCount = 1;
            if (newCount > 20) newCount = 20;
            
            if (newCount > product.count) {
                for (let i = product.count; i < newCount; i++) {
                    product.parts.push("");
                }
            } else {
                product.parts = product.parts.slice(0, newCount);
            }
            
            product.count = newCount;
            renderProducts();
            updateStats();
            saveToStorage();
        }

        // ═══════════════════════════════════════════════════════════════
        // RENDER PRODUCTS
        // ═══════════════════════════════════════════════════════════════
        function renderProducts() {
            const container = document.getElementById('productList');
            const emptyState = document.getElementById('emptyState');
            
            if (state.products.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            container.innerHTML = state.products.map((product, index) => {
                const partsHTML = product.parts.map((part, i) => `
                    <input type="text" 
                           class="part-input" 
                           value="${escapeHtml(part)}" 
                           placeholder="${t('package')} ${i + 1}"
                           oninput="updatePartName(${product.id}, ${i}, this.value)">
                `).join('');
                
                const desi = calculateDesiValue(product.width || 0, product.height || 0, product.depth || 0);
                
                const dimensionsHTML = state.settings.showDimensions ? `
                    <div class="dimensions-row">
                        <div class="dim-group">
                            <span class="dim-label">${t('weight')}</span>
                            <input type="number" step="0.1" min="0" 
                                   class="dim-input" 
                                   value="${product.weight || ''}" 
                                   placeholder="kg"
                                   oninput="updateProductDimension(${product.id}, 'weight', this.value)">
                        </div>
                        <div class="dim-group">
                            <span class="dim-label">En</span>
                            <input type="number" step="1" min="0" 
                                   class="dim-input" 
                                   value="${product.width || ''}" 
                                   placeholder="cm"
                                   oninput="updateProductDimension(${product.id}, 'width', this.value)">
                        </div>
                        <div class="dim-group">
                            <span class="dim-label">Boy</span>
                            <input type="number" step="1" min="0" 
                                   class="dim-input" 
                                   value="${product.height || ''}" 
                                   placeholder="cm"
                                   oninput="updateProductDimension(${product.id}, 'height', this.value)">
                        </div>
                        <div class="dim-group">
                            <span class="dim-label">Yük.</span>
                            <input type="number" step="1" min="0" 
                                   class="dim-input" 
                                   value="${product.depth || ''}" 
                                   placeholder="cm"
                                   oninput="updateProductDimension(${product.id}, 'depth', this.value)">
                        </div>
                        ${desi > 0 ? `<div class="desi-badge"><i class="fa-solid fa-cube"></i> ${desi.toFixed(1)} ${t('desi')}</div>` : ''}
                    </div>
                ` : '';
                
                return `
                    <div class="product-row" data-id="${product.id}">
                        <div class="row-handle" title="${t('drag')}">
                            <i class="fa-solid fa-grip-vertical"></i>
                        </div>
                        <div class="product-info">
                            <input type="text" 
                                   class="form-input product-name-input" 
                                   value="${escapeHtml(product.name)}" 
                                   placeholder="${t('productNamePlaceholder')}"
                                   oninput="updateProductName(${product.id}, this.value)">
                            <div class="parts-grid">${partsHTML}</div>
                            ${dimensionsHTML}
                        </div>
                        <div class="package-controls">
                            <span class="package-label">${t('package')}</span>
                            <div class="counter-box">
                                <button class="counter-btn" onclick="changeCount(${product.id}, -1)">−</button>
                                <span class="counter-val">${product.count}</span>
                                <button class="counter-btn" onclick="changeCount(${product.id}, 1)">+</button>
                            </div>
                        </div>
                        <div class="row-actions">
                            <button onclick="removeProduct(${product.id})" class="btn btn-ghost btn-icon delete-btn" title="${t('delete')}">
                                <i class="fa-solid fa-trash-can"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateStats() {
            const productCount = state.products.length;
            const packageCount = state.products.reduce((sum, p) => sum + p.count, 0);
            const pageCount = packageCount;
            
            // Toplam ağırlık ve desi hesapla
            let totalWeight = 0;
            let totalDesi = 0;
            
            state.products.forEach(p => {
                const multiplier = p.count;
                totalWeight += (p.weight || 0) * multiplier;
                const desi = calculateDesiValue(p.width || 0, p.height || 0, p.depth || 0);
                totalDesi += desi * multiplier;
            });
            
            // Değerleri güncelle
            document.getElementById('statProducts').textContent = productCount;
            document.getElementById('statPackages').textContent = packageCount;
            document.getElementById('statPages').textContent = pageCount;
            document.getElementById('statDesi').textContent = totalDesi.toFixed(1);
            document.getElementById('statWeight').textContent = totalWeight.toFixed(1);
        }

        // ═══════════════════════════════════════════════════════════════
        // BULK ADD
        // ═══════════════════════════════════════════════════════════════
        function processBulkText() {
            const text = document.getElementById('bulkText').value;
            const lines = text.split('\n').filter(l => l.trim() !== '');
            
            if (lines.length === 0) {
                showToast('Metin boş!', 'warning');
                return;
            }
            
            saveHistory();
            
            lines.forEach(line => {
                let name = line.trim();
                let count = 1;
                let parts = [""];
                
                const braceMatch = line.match(/(.*)\{(.+)\}\s*$/);
                const starMatch = line.match(/(?:\s*[\*xX](\d+))\s*$/);
                
                if (braceMatch) {
                    name = braceMatch[1].trim();
                    parts = braceMatch[2].split(',').map(p => p.trim());
                    count = parts.length;
                } else if (starMatch) {
                    count = parseInt(starMatch[1]);
                    name = line.replace(starMatch[0], '').trim();
                    parts = new Array(count).fill("");
                }
                
                state.products.push({ 
                    id: nextId++, 
                    name, 
                    count, 
                    parts,
                    weight: 0,
                    width: 0,
                    height: 0,
                    depth: 0
                });
            });
            
            renderProducts();
            updateStats();
            saveToStorage();
            closeModal('bulkModal');
            document.getElementById('bulkText').value = '';
            showToast(`${lines.length} ürün eklendi!`, 'success');
        }

        // ═══════════════════════════════════════════════════════════════
        // TEMPLATES
        // ═══════════════════════════════════════════════════════════════
        function loadTemplates() {
            const templates = JSON.parse(localStorage.getItem(TEMPLATES_KEY) || '[]');
            const container = document.getElementById('templatesList');
            
            if (templates.length === 0) {
                container.innerHTML = '<div class="dropdown-empty">Kayıtlı şablon yok</div>';
                return;
            }
            
            container.innerHTML = templates.map((t, i) => `
                <div class="dropdown-item" onclick="loadTemplate(${i})">
                    <i class="fa-solid fa-file-lines" style="color: var(--color-info);"></i>
                    <span class="template-name">${escapeHtml(t.name)}</span>
                    <button onclick="event.stopPropagation(); deleteTemplate(${i})" class="delete-template">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
            `).join('');
        }
        
        function saveAsTemplate() {
            toggleDropdown('templatesDropdown');
            openModal('templateNameModal');
            document.getElementById('templateName').value = '';
            setTimeout(() => document.getElementById('templateName').focus(), 100);
        }
        
        function confirmSaveTemplate() {
            const name = document.getElementById('templateName').value.trim();
            if (!name) {
                showToast('Şablon adı gerekli!', 'warning');
                return;
            }
            
            const templates = JSON.parse(localStorage.getItem(TEMPLATES_KEY) || '[]');
            templates.push({
                name,
                products: JSON.parse(JSON.stringify(state.products)),
                settings: JSON.parse(JSON.stringify(state.settings)),
                sender: {
                    company: document.getElementById('senderCompany').value,
                    person: document.getElementById('senderPerson').value,
                    phone: document.getElementById('senderPhone').value,
                    street: document.getElementById('senderStreet').value,
                    district: document.getElementById('senderDistrict').value,
                    city: document.getElementById('senderCity').value
                },
                receiver: {
                    company: document.getElementById('receiverCompany').value,
                    person: document.getElementById('receiverPerson').value,
                    phone: document.getElementById('receiverPhone').value,
                    street: document.getElementById('receiverStreet').value,
                    district: document.getElementById('receiverDistrict').value,
                    city: document.getElementById('receiverCity').value
                }
            });
            
            localStorage.setItem(TEMPLATES_KEY, JSON.stringify(templates));
            loadTemplates();
            closeModal('templateNameModal');
            showToast('Şablon kaydedildi!', 'success');
        }
        
        function loadTemplate(index) {
            const templates = JSON.parse(localStorage.getItem(TEMPLATES_KEY) || '[]');
            const t = templates[index];
            if (!t) return;
            
            saveHistory();
            
            state.products = JSON.parse(JSON.stringify(t.products));
            state.settings = { ...state.settings, ...t.settings };
            
            // Yeni format (object with street/district/city)
            if (t.sender && typeof t.sender === 'object') {
                document.getElementById('senderCompany').value = t.sender.company || '';
                document.getElementById('senderPerson').value = t.sender.person || '';
                document.getElementById('senderPhone').value = t.sender.phone || '';
                document.getElementById('senderStreet').value = t.sender.street || '';
                document.getElementById('senderDistrict').value = t.sender.district || '';
                document.getElementById('senderCity').value = t.sender.city || '';
            }
            
            // Yeni format (object with street/district/city)
            if (t.receiver && typeof t.receiver === 'object') {
                document.getElementById('receiverCompany').value = t.receiver.company || '';
                document.getElementById('receiverPerson').value = t.receiver.person || '';
                document.getElementById('receiverPhone').value = t.receiver.phone || '';
                document.getElementById('receiverStreet').value = t.receiver.street || '';
                document.getElementById('receiverDistrict').value = t.receiver.district || '';
                document.getElementById('receiverCity').value = t.receiver.city || '';
            }
            
            // Otomatik barkod oluştur
            generateAutoPrefix();
            
            applyThemeColor(state.settings.theme);
            document.querySelectorAll('.color-option').forEach(el => {
                el.classList.toggle('active', el.dataset.color === state.settings.theme);
            });
            Object.keys(state.settings.icons).forEach(key => {
                const btn = document.getElementById('btn-' + key);
                if (btn) btn.classList.toggle('active', state.settings.icons[key]);
            });
            setBarcodeType(state.settings.barcodeType, false);
            
            renderProducts();
            updateStats();
            saveToStorage();
            toggleDropdown('templatesDropdown');
            showToast(`"${t.name}" şablonu yüklendi!`, 'success');
        }
        
        function deleteTemplate(index) {
            if (!confirm('Bu şablonu silmek istediğinize emin misiniz?')) return;
            
            const templates = JSON.parse(localStorage.getItem(TEMPLATES_KEY) || '[]');
            templates.splice(index, 1);
            localStorage.setItem(TEMPLATES_KEY, JSON.stringify(templates));
            loadTemplates();
            showToast('Şablon silindi!', 'success');
        }

        // ═══════════════════════════════════════════════════════════════
        // LABEL GENERATION
        // ═══════════════════════════════════════════════════════════════
        
        // Inline SVG definitions for PDF/Print compatibility
        const inlineSVGs = {
            'icon-fragile': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <path d="M30,8 L30,35 Q30,50 50,50 Q70,50 70,35 L70,8" fill="none" stroke="#000000" stroke-width="5" stroke-linejoin="round"/>
                <line x1="50" y1="50" x2="50" y2="75" stroke="#000000" stroke-width="5"/>
                <path d="M32,75 L68,75 L68,80 L32,80 Z" fill="#000000"/>
                <path d="M50,15 L42,28 L54,35 L44,48" fill="none" stroke="#000000" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M58,20 L65,12 M60,25 L68,22" fill="none" stroke="#000000" stroke-width="3" stroke-linecap="round"/>
            </svg>`,
            'icon-up': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <path d="M30,70 L30,30 L15,45" fill="none" stroke="#000000" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M30,30 L45,45" fill="none" stroke="#000000" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M70,70 L70,30 L55,45" fill="none" stroke="#000000" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M70,30 L85,45" fill="none" stroke="#000000" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="8" y1="88" x2="92" y2="88" stroke="#000000" stroke-width="6" stroke-linecap="round"/>
            </svg>`,
            'icon-dry': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <path d="M10,42 Q10,12 50,12 Q90,12 90,42" fill="none" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
                <path d="M50,12 L50,78 Q50,88 58,88" fill="none" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
                <line x1="20" y1="52" x2="16" y2="62" stroke="#000000" stroke-width="4" stroke-linecap="round"/>
                <line x1="12" y1="68" x2="8" y2="78" stroke="#000000" stroke-width="4" stroke-linecap="round"/>
                <line x1="80" y1="52" x2="84" y2="62" stroke="#000000" stroke-width="4" stroke-linecap="round"/>
                <line x1="88" y1="68" x2="92" y2="78" stroke="#000000" stroke-width="4" stroke-linecap="round"/>
            </svg>`,
            'icon-knife': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="42" fill="none" stroke="#000000" stroke-width="5"/>
                <rect x="28" y="42" width="30" height="16" rx="2" fill="#000000"/>
                <polygon points="58,45 78,45 78,50 72,55 58,55" fill="#000000"/>
                <line x1="58" y1="50" x2="72" y2="50" stroke="white" stroke-width="1"/>
                <line x1="20" y1="20" x2="80" y2="80" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
            </svg>`,
            'icon-heat': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <circle cx="75" cy="25" r="12" fill="none" stroke="#000000" stroke-width="4"/>
                <line x1="75" y1="5" x2="75" y2="10" stroke="#000000" stroke-width="3" stroke-linecap="round"/>
                <line x1="95" y1="25" x2="90" y2="25" stroke="#000000" stroke-width="3" stroke-linecap="round"/>
                <line x1="89" y1="11" x2="85" y2="15" stroke="#000000" stroke-width="3" stroke-linecap="round"/>
                <line x1="89" y1="39" x2="85" y2="35" stroke="#000000" stroke-width="3" stroke-linecap="round"/>
                <path d="M58,30 Q55,35 58,40" fill="none" stroke="#000000" stroke-width="2"/>
                <path d="M52,28 Q49,35 52,42" fill="none" stroke="#000000" stroke-width="2"/>
                <path d="M46,26 Q43,35 46,44" fill="none" stroke="#000000" stroke-width="2"/>
                <rect x="12" y="45" width="40" height="40" fill="none" stroke="#000000" stroke-width="4" rx="2"/>
                <path d="M60,65 L75,65 L70,58 M75,65 L70,72" fill="none" stroke="#000000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>`,
            'icon-nostack': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <rect x="20" y="55" width="40" height="30" fill="none" stroke="#000000" stroke-width="4" rx="2"/>
                <rect x="25" y="25" width="30" height="25" fill="none" stroke="#000000" stroke-width="3" rx="2" stroke-dasharray="4,2"/>
                <line x1="25" y1="25" x2="55" y2="50" stroke="#000000" stroke-width="4" stroke-linecap="round"/>
                <line x1="55" y1="25" x2="25" y2="50" stroke="#000000" stroke-width="4" stroke-linecap="round"/>
                <path d="M75,30 L75,70 L65,60 M75,70 L85,60" fill="none" stroke="#000000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>`,
            'icon-care': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <path d="M15,60 Q10,50 15,40 L25,40 L25,30 Q25,25 30,25 L35,25 Q40,25 40,30 L40,55" fill="none" stroke="#000000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M85,60 Q90,50 85,40 L75,40 L75,30 Q75,25 70,25 L65,25 Q60,25 60,30 L60,55" fill="none" stroke="#000000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <rect x="35" y="45" width="30" height="25" fill="none" stroke="#000000" stroke-width="4" rx="2"/>
                <circle cx="50" cy="35" r="3" fill="#000000"/>
                <line x1="50" y1="25" x2="50" y2="30" stroke="#000000" stroke-width="2"/>
                <line x1="42" y1="35" x2="37" y2="35" stroke="#000000" stroke-width="2"/>
                <line x1="58" y1="35" x2="63" y2="35" stroke="#000000" stroke-width="2"/>
            </svg>`,
            'icon-sling': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <rect x="15" y="40" width="70" height="45" fill="none" stroke="#000000" stroke-width="4" rx="2"/>
                <path d="M35,40 L35,20 L50,8 L65,20 L65,40" fill="none" stroke="#000000" stroke-width="4" stroke-linejoin="round"/>
                <circle cx="50" cy="12" r="6" fill="none" stroke="#000000" stroke-width="3"/>
                <circle cx="35" cy="40" r="4" fill="#000000"/>
                <circle cx="65" cy="40" r="4" fill="#000000"/>
            </svg>`,
            'icon-weight': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <circle cx="50" cy="20" r="10" fill="none" stroke="#000000" stroke-width="6"/>
                <path d="M35,30 L65,30 L76,90 L24,90 Z" fill="none" stroke="#000000" stroke-width="6" stroke-linejoin="round"/>
                <line x1="40" y1="55" x2="60" y2="55" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
                <line x1="44" y1="70" x2="56" y2="70" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
            </svg>`,
            'icon-cbm': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <path d="M20,35 L50,20 L80,35 L80,75 L50,90 L20,75 Z" fill="none" stroke="#000000" stroke-width="6" stroke-linejoin="round"/>
                <line x1="50" y1="20" x2="50" y2="90" stroke="#000000" stroke-width="4"/>
                <line x1="20" y1="35" x2="50" y2="50" stroke="#000000" stroke-width="4"/>
                <line x1="80" y1="35" x2="50" y2="50" stroke="#000000" stroke-width="4"/>
            </svg>`,
            'icon-volwt': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <rect x="30" y="30" width="40" height="40" fill="none" stroke="#000000" stroke-width="6" stroke-linejoin="round"/>
                <line x1="20" y1="30" x2="20" y2="70" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
                <path d="M14,38 L20,30 L26,38" fill="none" stroke="#000000" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M14,62 L20,70 L26,62" fill="none" stroke="#000000" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="30" y1="80" x2="70" y2="80" stroke="#000000" stroke-width="5" stroke-linecap="round"/>
                <path d="M38,74 L30,80 L38,86" fill="none" stroke="#000000" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M62,74 L70,80 L62,86" fill="none" stroke="#000000" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>`
        };
        
        function generateLabels(clearPrintArea = true) {
            if (state.products.length === 0) {
                showToast('Önce ürün ekleyin!', 'warning');
                return;
            }
            
            const hasEmptyNames = state.products.some(p => !p.name.trim());
            if (hasEmptyNames) {
                showToast('Boş ürün adları var!', 'warning');
                return;
            }
            
            // Gönderen bilgileri
            const senderCompany = document.getElementById('senderCompany').value.trim();
            const senderPerson = document.getElementById('senderPerson').value.trim();
            const senderPhone = document.getElementById('senderPhone').value.trim();
            const senderStreet = document.getElementById('senderStreet').value.trim();
            const senderDistrict = document.getElementById('senderDistrict').value.trim();
            const senderCity = document.getElementById('senderCity').value.trim();
            
            const senderTitle = senderCompany;
            const senderAddressParts = [];
            if (senderPerson) senderAddressParts.push(senderPerson);
            if (senderStreet) senderAddressParts.push(senderStreet);
            if (senderDistrict && senderCity) {
                senderAddressParts.push(`${senderDistrict} / ${senderCity}`);
            } else if (senderCity) {
                senderAddressParts.push(senderCity);
            }
            if (senderPhone) senderAddressParts.push(`Tel: ${senderPhone}`);
            const senderAddress = senderAddressParts.join('<br>');
            
            // Alıcı bilgileri
            const receiverCompany = document.getElementById('receiverCompany').value.trim();
            const receiverPerson = document.getElementById('receiverPerson').value.trim();
            const receiverPhone = document.getElementById('receiverPhone').value.trim();
            const receiverStreet = document.getElementById('receiverStreet').value.trim();
            const receiverDistrict = document.getElementById('receiverDistrict').value.trim();
            const receiverCity = document.getElementById('receiverCity').value.trim();
            
            const receiverTitle = receiverPerson ? `${receiverCompany} - ${receiverPerson}` : receiverCompany;
            const receiverAddressParts = [];
            if (receiverStreet) receiverAddressParts.push(receiverStreet);
            if (receiverDistrict && receiverCity) {
                receiverAddressParts.push(`${receiverDistrict} / ${receiverCity}`);
            } else if (receiverCity) {
                receiverAddressParts.push(receiverCity);
            }
            if (receiverPhone) receiverAddressParts.push(`Tel: ${receiverPhone}`);
            const receiverAddress = receiverAddressParts.join('<br>');
            
            const prefix = document.getElementById('codePrefix').value;
            const startNo = parseInt(document.getElementById('startNo').value) || 1;
            const today = new Date().toLocaleDateString(currentLang === 'tr' ? 'tr-TR' : 'en-GB');
            
            const leftIcons = [];
            if (state.settings.icons.fragile) leftIcons.push({ id: 'icon-fragile', text: t('iconFragile') });
            if (state.settings.icons.up) leftIcons.push({ id: 'icon-up', text: t('iconUp') });
            if (state.settings.icons.dry) leftIcons.push({ id: 'icon-dry', text: t('iconDry') });
            if (state.settings.icons.heat) leftIcons.push({ id: 'icon-heat', text: t('iconHeat') });
            if (state.settings.icons.nostack) leftIcons.push({ id: 'icon-nostack', text: t('iconNoStack') });
            if (state.settings.icons.care) leftIcons.push({ id: 'icon-care', text: t('iconCare') });
            if (state.settings.icons.sling) leftIcons.push({ id: 'icon-sling', text: t('iconSling') });
            
            const totalIcons = leftIcons.length + (state.settings.icons.knife ? 1 : 0);
            const compactClass = totalIcons > 4 ? 'compact' : '';
            
            const leftIconsHTML = `<div class="icons-wrapper ${compactClass}">${leftIcons.map(ic => `
                <div class="icon-item">
                    ${inlineSVGs[ic.id]}
                    <span class="icon-text">${ic.text}</span>
                </div>
            `).join('')}</div>`;
            
            const knifeHTML = state.settings.icons.knife ? `
                <div class="icons-wrapper ${compactClass}">
                    <div class="icon-item">
                        ${inlineSVGs['icon-knife']}
                        <span class="icon-text">${t('iconKnife')}</span>
                    </div>
                </div>
            ` : '';
            
            const labelsToPrint = [];
            state.products.forEach(prod => {
                for (let i = 0; i < prod.count; i++) {
                    const partName = prod.parts[i] || `Paket ${i + 1}`;
                    const labelData = { 
                        name: prod.name, 
                        weight: (prod.weight || 0),
                        volumeM3: calculateM3((prod.width || 0), (prod.height || 0), (prod.depth || 0)),
                        desi: calculateDesiValue((prod.width || 0), (prod.height || 0), (prod.depth || 0)),
                        partIndex: i,
                        partName: partName,
                        totalParts: prod.count,
                        allParts: prod.parts.map((p, idx) => p || `Paket ${idx + 1}`),
                        hasMultipleParts: prod.count > 1
                    };
                    labelsToPrint.push(labelData);
                }
            });
            
            // Tek etiket mi çift etiket mi?
            const isSingleLabel = ['a4-landscape', 'a5', 'thermal-100x150', 'thermal-100x70'].includes(state.settings.labelSize);
            
            const totalUniquePackages = labelsToPrint.length;
            const printArea = document.getElementById('printArea');
            if (clearPrintArea) printArea.innerHTML = '';
            
            for (let i = 0; i < labelsToPrint.length; i++) {
                const label = labelsToPrint[i];
                const globalPkgIndex = i + 1;
                const currentTrackingNum = startNo + i;
                const code = `${prefix}${String(currentTrackingNum).padStart(4, '0')}`;
                
                // Use custom logo or default
                const logoSrc = state.settings.customLogo || 'https://static.ticimax.cloud/69640/uploads/editoruploads/gasell-logo-0.svg';
                
                // Parça listesi HTML'i oluştur
                const createPartsListHTML = (data) => {
                    if (!data.hasMultipleParts) return '';
                    
                    const partsHTML = data.allParts.map((part, idx) => {
                        const isActive = idx === data.partIndex;
                        return `<span class="part-item ${isActive ? 'active' : ''}">
                            <span class="part-dot"></span>
                            ${escapeHtml(part)}
                        </span>`;
                    }).join('');
                    
                    return `
                        <div class="parts-list-container">
                            <div class="parts-list">
                                ${partsHTML}
                                <span class="part-number-badge">${data.partIndex + 1} / ${data.totalParts}</span>
                            </div>
                        </div>
                    `;
                    };


                const createMetricsHTML = (data) => {
                    const w = (data.weight && data.weight > 0) ? `${data.weight.toFixed(1)} kg` : `— kg`;
                    const cbm = (data.volumeM3 && data.volumeM3 > 0) ? `${data.volumeM3.toFixed(3)} m³` : `— m³`;
                    const vw = (data.desi && data.desi > 0) ? `${data.desi.toFixed(1)} desi` : `— desi`;

                    return `
                        <div class="metrics-wrapper">
                            <div class="metric-item" title="Gross Weight">
                                ${inlineSVGs['icon-weight']}
                                <div class="metric-lines">
                                    <div class="metric-value">${w}</div>
                                    <div class="metric-label">G.W.</div>
                                </div>
                            </div>
                            <div class="metric-item" title="Cubic Meter">
                                ${inlineSVGs['icon-cbm']}
                                <div class="metric-lines">
                                    <div class="metric-value">${cbm}</div>
                                    <div class="metric-label">CBM</div>
                                </div>
                            </div>
                            <div class="metric-item" title="Volumetric Weight">
                                ${inlineSVGs['icon-volwt']}
                                <div class="metric-lines">
                                    <div class="metric-value">${vw}</div>
                                    <div class="metric-label">VOL. WT</div>
                                </div>
                            </div>
                        </div>
                    `;
                };

                const createLabelHTML = (data, trackingCode) => `
                    <div class="label-box" style="border-color:${state.settings.theme}">
                        <div class="lbl-header">
                            <img src="${logoSrc}" alt="Logo" class="lbl-logo">
                            <span class="lbl-service" style="color:${state.settings.theme}">${t('shippingLabel')}</span>
                        </div>
                        <div class="lbl-addresses">
                            <div class="lbl-sender">
                                <span class="section-label">${t('senderLabel')}</span>
                                <div class="company-name">${escapeHtml(senderTitle)}</div>
                                <div class="address-text">${senderAddress}</div>
                            </div>
                            <div class="lbl-receiver">
                                <span class="section-label">${t('receiverLabel')}</span>
                                <div class="company-name receiver-big">${escapeHtml(receiverTitle)}</div>
                                <div class="address-text">${receiverAddress}</div>
                            </div>
                        </div>
                        <div class="lbl-details">
                            <div class="lbl-detail-col wide">
                                <span class="section-label">${t('contentInfo')}</span>
                                <div class="product-name-label">${escapeHtml(data.name)}</div>
                                ${data.hasMultipleParts ? `<div class="part-name-label" style="color:${state.settings.theme}">▶ ${escapeHtml(data.partName)}</div>` : ''}
                                ${createPartsListHTML(data)}
                            </div>
                            <div class="lbl-detail-col narrow">
                                <div class="package-badge">
                                    <div class="package-val">${globalPkgIndex}<span class="package-val-divider">/</span>${totalUniquePackages}</div>
                                    <div class="package-label-text">${t('packageNo')}</div>
                                </div>
                            </div>
                        </div>
                        <div class="lbl-footer">
                            <div class="footer-left">
                                <div class="footer-left-stack">
                                    ${leftIconsHTML}
                                    ${state.settings.showDimensions ? createMetricsHTML(data) : ''}
                                </div>
                            </div>
                            <div class="footer-center">
                                <div class="barcode-area">
                                    <div id="barcode-${trackingCode.replace(/[^a-zA-Z0-9]/g, '')}"></div>
                                    <div class="tracking-no">${trackingCode}</div>
                                </div>
                            </div>
                            <div class="footer-right">
                                <div class="footer-right-stack">
                                    ${knifeHTML}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                const page = document.createElement('div');
                page.className = `page-sheet size-${state.settings.labelSize}`;
                
                // A4 Landscape için inline style ile boyut zorla
                if (state.settings.labelSize === 'a4-landscape') {
                    page.style.width = '297mm';
                    page.style.height = '210mm';
                }
                
                if (isSingleLabel) {
                    // Tek etiket formatları (A4 Yatay, A5, Termal)
                    page.innerHTML = `
                        <div class="page-info">${t('pageOf')} ${globalPkgIndex} / ${totalUniquePackages}</div>
                        <div class="date-stamp">${today}</div>
                        <div class="label-container">
                            ${createLabelHTML(label, code)}
                        </div>
                    `;
                } else {
                    // Çift etiket formatı (A4 Dikey - sayfa başına 2 etiket)
                    page.innerHTML = `
                        <div class="page-info">${t('pageOf')} ${globalPkgIndex} / ${totalUniquePackages}</div>
                        <div class="date-stamp">${today}</div>
                        <div class="cut-line" data-text="${t('cutLine')}"></div>
                        <div class="label-container">
                            ${createLabelHTML(label, code)}
                        </div>
                        <div class="label-container">
                            ${createLabelHTML(label, code)}
                        </div>
                    `;
                }
                
                printArea.appendChild(page);
            }
            
            setTimeout(() => {
                for (let i = 0; i < labelsToPrint.length; i++) {
                    const currentTrackingNum = startNo + i;
                    const code = `${prefix}${String(currentTrackingNum).padStart(4, '0')}`;
                    const safeCode = code.replace(/[^a-zA-Z0-9]/g, '');
                    
                    document.querySelectorAll(`#barcode-${safeCode}`).forEach(el => {
                        if (state.settings.barcodeType === 'qr') {
                            const qr = qrcode(0, 'M');
                            qr.addData(code);
                            qr.make();
                            el.innerHTML = qr.createImgTag(2, 0);
                            el.querySelector('img').classList.add('qr-code');
                        } else {
                            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                            svg.classList.add('barcode-svg');
                            el.appendChild(svg);
                            JsBarcode(svg, code, {
                                format: "CODE128",
                                width: 1.5,
                                height: 35,
                                displayValue: false,
                                margin: 0
                            });
                        }
                    });
                }
                
                updatePreview();
                showToast(`${totalUniquePackages} etiket oluşturuldu!`, 'success');
            }, 100);
        }
        
        function updatePreview() {
            const previewScroll = document.getElementById('previewScroll');
            const printArea = document.getElementById('printArea');
            
            if (printArea.children.length === 0) {
                previewScroll.innerHTML = '<p class="preview-empty">Önizleme için "Etiketleri Oluştur" butonuna tıklayın</p>';
                return;
            }
            
            const firstPage = printArea.children[0].cloneNode(true);
            firstPage.classList.add('preview-label');
            previewScroll.innerHTML = '';
            previewScroll.appendChild(firstPage);
            
            document.getElementById('previewContent').classList.add('active');
            document.getElementById('previewChevron').classList.add('rotated');
        }
        
        function togglePreview() {
            const content = document.getElementById('previewContent');
            const chevron = document.getElementById('previewChevron');
            content.classList.toggle('active');
            chevron.classList.toggle('rotated');
        }

        // ═══════════════════════════════════════════════════════════════
        // PRINT FUNCTION WITH DYNAMIC PAGE SIZE - DÜZELTILMIŞ
        // ═══════════════════════════════════════════════════════════════
        function printLabels() {
            const printArea = document.getElementById('printArea');
            
            // Etiket yoksa önce oluştur
            if (printArea.children.length === 0) {
                generateLabels();
                // Etiketler oluşturulduktan sonra yazdır
                setTimeout(() => executePrint(), 600);
                return;
            }
            
            executePrint();
        }
        
        function executePrint() {
            const printArea = document.getElementById('printArea');
            if (printArea.children.length === 0) {
                showToast('Önce etiketleri oluşturun!', 'warning');
                return;
            }
            
            // Mevcut print style'ı kaldır
            const existingStyle = document.getElementById('dynamicPrintStyle');
            if (existingStyle) existingStyle.remove();
            
            // Yeni print style oluştur
            const printStyle = document.createElement('style');
            printStyle.id = 'dynamicPrintStyle';
            
            // Set page orientation based on label size
            let pageCSS = '';
            let warningMsg = '';
            
            if (state.settings.labelSize === 'a4-landscape') {
                pageCSS = `
                    @media print {
                        @page { 
                            size: A4 landscape !important; 
                            margin: 0 !important; 
                        }
                        body { 
                            margin: 0 !important; 
                            padding: 0 !important; 
                        }
                        #printArea {
                            display: block !important;
                        }
                        .page-sheet.size-a4-landscape {
                            width: 297mm !important;
                            height: 210mm !important;
                            page-break-after: always !important;
                            page-break-inside: avoid !important;
                            box-shadow: none !important;
                            margin: 0 !important;
                        }
                        .page-sheet.size-a4-landscape:last-child {
                            page-break-after: auto !important;
                        }
                    }
                `;
                warningMsg = '⚠️ Yazdırma ayarlarında "Yatay/Landscape" seçin!';
            } else if (state.settings.labelSize === 'thermal-100x150') {
                pageCSS = `
                    @media print {
                        @page { size: 100mm 150mm !important; margin: 0 !important; }
                        .page-sheet { page-break-after: always !important; }
                    }
                `;
            } else if (state.settings.labelSize === 'thermal-100x70') {
                pageCSS = `
                    @media print {
                        @page { size: 100mm 70mm !important; margin: 0 !important; }
                        .page-sheet { page-break-after: always !important; }
                    }
                `;
            } else {
                pageCSS = `
                    @media print {
                        @page { size: A4 portrait !important; margin: 0 !important; }
                        .page-sheet { page-break-after: always !important; }
                    }
                `;
            }
            
            printStyle.textContent = pageCSS;
            document.head.appendChild(printStyle);
            
            // Uyarı göster
            if (warningMsg) {
                showToast(warningMsg, 'warning', 4000);
            }
            
            // Print işlemini başlat
            setTimeout(() => {
                window.print();
            }, 400);
        }

        // ═══════════════════════════════════════════════════════════════
        // PDF EXPORT - DÜZELTILMIŞ VERSİYON
        // ═══════════════════════════════════════════════════════════════
        async function exportPDF() {
            const printArea = document.getElementById('printArea');
            
            // Etiket yoksa önce oluştur
            if (printArea.children.length === 0) {
                generateLabels();
                await new Promise(r => setTimeout(r, 800));
            }
            
            if (printArea.children.length === 0) {
                showToast('Önce etiketleri oluşturun!', 'warning');
                return;
            }
            
            showLoading(true);
            
            try {
                // Determine PDF orientation and format based on label size
                let orientation = 'portrait';
                let format = 'a4';
                let pageWidth, pageHeight;
                
                if (state.settings.labelSize === 'a4-landscape') {
                    orientation = 'landscape';
                    format = 'a4';
                    pageWidth = 297;
                    pageHeight = 210;
                } else if (state.settings.labelSize === 'thermal-100x150') {
                    format = [100, 150];
                    pageWidth = 100;
                    pageHeight = 150;
                } else if (state.settings.labelSize === 'thermal-100x70') {
                    format = [100, 70];
                    pageWidth = 100;
                    pageHeight = 70;
                } else {
                    pageWidth = 210;
                    pageHeight = 297;
                }
                
                // Her sayfa için ayrı PDF oluştur ve birleştir
                const pages = Array.from(printArea.children);
                const totalPages = pages.length;
                
                // Geçici container oluştur
                const tempContainer = document.createElement('div');
                tempContainer.id = 'tempPdfContainer';
                tempContainer.style.cssText = 'position: absolute; left: -9999px; top: 0; background: white;';
                document.body.appendChild(tempContainer);
                
                // Tüm sayfaları klonla ve container'a ekle
                pages.forEach((page, index) => {
                    const clone = page.cloneNode(true);
                    clone.style.cssText = `
                        width: ${pageWidth}mm !important;
                        height: ${pageHeight}mm !important;
                        margin: 0 !important;
                        padding: 0 !important;
                        box-shadow: none !important;
                        page-break-after: always !important;
                        page-break-inside: avoid !important;
                        display: block !important;
                        overflow: hidden !important;
                    `;
                    if (index === totalPages - 1) {
                        clone.style.pageBreakAfter = 'auto';
                    }
                    tempContainer.appendChild(clone);
                });
                
                const opt = {
                    margin: 0,
                    filename: `Gasell_Etiketler_${new Date().toISOString().slice(0,10)}.pdf`,
                    image: { type: 'jpeg', quality: 0.95 },
                    html2canvas: { 
                        scale: 2, 
                        useCORS: true,
                        logging: false,
                        allowTaint: true,
                        backgroundColor: '#ffffff'
                    },
                    jsPDF: { 
                        unit: 'mm', 
                        format: format, 
                        orientation: orientation,
                        compress: true
                    },
                    pagebreak: { 
                        mode: ['css', 'legacy'],
                        before: '.page-sheet',
                        after: '.page-sheet',
                        avoid: ['.label-box', '.label-container']
                    }
                };
                
                await html2pdf().set(opt).from(tempContainer).save();
                
                // Temizlik
                document.body.removeChild(tempContainer);
                
                showToast(`PDF indirildi! (${totalPages} sayfa)`, 'success');
            } catch (error) {
                console.error('PDF Error:', error);
                showToast('PDF oluşturulurken hata: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // ═══════════════════════════════════════════════════════════════
        // UI HELPERS
        // ═══════════════════════════════════════════════════════════════
        function openModal(id) {
            document.getElementById(id).classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
            document.body.style.overflow = '';
        }
        
        function closeModalOnOverlay(e, id) {
            if (e.target === e.currentTarget) closeModal(id);
        }
        
        function toggleDropdown(id) {
            const dropdown = document.getElementById(id);
            
            document.querySelectorAll('.dropdown.active').forEach(d => {
                if (d.id !== id) d.classList.remove('active');
            });
            
            dropdown.classList.toggle('active');
        }
        
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.dropdown')) {
                document.querySelectorAll('.dropdown.active').forEach(d => d.classList.remove('active'));
            }
        });
        
        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <i class="fa-solid ${icons[type] || icons.info}"></i>
                <span>${escapeHtml(message)}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => toast.remove(), duration);
        }
        
        // ═══════════════════════════════════════════════════════════════
        // GÖNDERENBİLGİSİ YÖNETİMİ
        // ═══════════════════════════════════════════════════════════════
        function toggleSenderEdit() {
            const display = document.getElementById('senderDisplay');
            const form = document.getElementById('senderEditForm');
            const btn = document.getElementById('senderEditBtn');
            
            if (form.style.display === 'none') {
                display.style.display = 'none';
                form.style.display = 'block';
                btn.innerHTML = '<i class="fa-solid fa-times"></i> İptal';
            } else {
                display.style.display = 'block';
                form.style.display = 'none';
                btn.innerHTML = '<i class="fa-solid fa-pen"></i> Düzenle';
            }
        }
        
        function saveSenderInfo() {
            const company = document.getElementById('senderCompany').value;
            const person = document.getElementById('senderPerson').value;
            const phone = document.getElementById('senderPhone').value;
            const street = document.getElementById('senderStreet').value;
            const district = document.getElementById('senderDistrict').value;
            const city = document.getElementById('senderCity').value;
            
            // Görünümü güncelle
            let detailsHtml = '';
            if (person) detailsHtml += person + '<br>';
            if (street) detailsHtml += street + '<br>';
            if (district && city) detailsHtml += `${district} / ${city}<br>`;
            else if (city) detailsHtml += city + '<br>';
            if (phone) detailsHtml += `Tel: ${phone}`;
            
            document.querySelector('.sender-info-card .sender-company').textContent = company;
            document.querySelector('.sender-info-card .sender-details').innerHTML = detailsHtml;
            
            // Formu kapat
            toggleSenderEdit();
            showToast('Gönderen bilgileri güncellendi!', 'success');
        }
        
        // ═══════════════════════════════════════════════════════════════
        // DESİ HESAPLAMA ARACI
        // ═══════════════════════════════════════════════════════════════
        function calculateDesiForProduct(productId) {
            const product = state.products.find(p => p.id === productId);
            if (!product) return 0;
            
            const width = parseFloat(product.width) || 0;
            const height = parseFloat(product.height) || 0;
            const depth = parseFloat(product.depth) || 0;
            
            // Desi = (En x Boy x Yükseklik) / 3000
            const desi = (width * height * depth) / 3000;
            
            return desi.toFixed(2);
        }
        
        function updateProductDimension(productId, field, value) {
            const product = state.products.find(p => p.id === productId);
            if (product) {
                product[field] = parseFloat(value) || 0;
                
                // Desi'yi hesapla ve göster
                const desi = calculateDesiForProduct(productId);
                const desiEl = document.getElementById(`desi-${productId}`);
                if (desiEl) {
                    desiEl.textContent = desi > 0 ? `${desi} desi` : '-';
                }
                
                updateStats();
                saveToStorage();
            }
        }
        
        function updateProductWeight(productId, value) {
            const product = state.products.find(p => p.id === productId);
            if (product) {
                product.weight = parseFloat(value) || 0;
                saveToStorage();
            }
        }
        
        // ═══════════════════════════════════════════════════════════════
        // ZOOM ÖNİZLEME
        // ═══════════════════════════════════════════════════════════════
        let currentZoom = 100;
        
        function openZoomPreview() {
            const printArea = document.getElementById('printArea');
            if (printArea.children.length === 0) {
                showToast('Önce etiketleri oluşturun!', 'warning');
                return;
            }
            
            const firstLabel = printArea.children[0].cloneNode(true);
            const container = document.getElementById('zoomLabelContainer');
            container.innerHTML = '';
            container.appendChild(firstLabel);
            
            // Yüksek kalite için stil ayarları
            firstLabel.style.imageRendering = 'high-quality';
            firstLabel.style.webkitFontSmoothing = 'antialiased';
            firstLabel.style.mozOsxFontSmoothing = 'grayscale';
            
            currentZoom = 100;
            updateZoomLevel();
            openModal('zoomPreviewModal');
        }
        
        function zoomIn() {
            if (currentZoom < 400) {
                currentZoom += 25;
                updateZoomLevel();
            }
        }
        
        function zoomOut() {
            if (currentZoom > 25) {
                currentZoom -= 25;
                updateZoomLevel();
            }
        }
        
        function resetZoom() {
            currentZoom = 100;
            updateZoomLevel();
        }
        
        function updateZoomLevel() {
            const container = document.getElementById('zoomLabelContainer');
            container.style.transform = `scale(${currentZoom / 100})`;
            container.style.transformOrigin = 'top center';
            document.getElementById('zoomLevelDisplay').textContent = `${currentZoom}%`;
        }
        
        function showLoading(show) {
            document.getElementById('loadingOverlay').classList.toggle('active', show);
        }
        
        function escapeHtml(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }
        
        // Multi-Receiver Functions - DÜZELTILMIŞ
        function openMultiReceiverModal() {
            openModal('multiReceiverModal');
            renderReceiverList();
        }
        
        function addReceiverField() {
            state.receivers.push({
                id: Date.now(),
                company: '',
                person: '',
                phone: '',
                street: '',
                district: '',
                city: '',
                prefix: ''
            });
            renderReceiverList();
            saveToStorage();
        }
        
        function removeReceiver(id) {
            state.receivers = state.receivers.filter(r => r.id !== id);
            renderReceiverList();
            saveToStorage();
        }
        
        function updateReceiver(id, field, value) {
            const receiver = state.receivers.find(r => r.id === id);
            if (receiver) {
                receiver[field] = value;
                saveToStorage();
            }
        }
        
        function renderReceiverList() {
            const container = document.getElementById('receiverListContainer');
            
            if (state.receivers.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: var(--text-muted); padding: 20px;">Henüz alıcı eklenmedi</p>`;
                return;
            }
            
            container.innerHTML = state.receivers.map((r, i) => `
                <div class="receiver-item" style="padding: 16px; background: var(--bg-tertiary); border-radius: var(--radius-md); margin-bottom: 12px; border: 1px solid var(--border-color);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <strong style="font-size: 0.85rem; color: var(--theme-color);">📦 Alıcı ${i + 1}</strong>
                        <button onclick="removeReceiver(${r.id})" class="btn btn-ghost btn-icon delete-btn" style="width: 28px; height: 28px;">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>
                    <div style="display: grid; gap: 8px;">
                        <input 
                            type="text" 
                            class="form-input" 
                            style="font-size: 0.85rem;"
                            placeholder="Firma Adı *"
                            value="${escapeHtml(r.company || '')}"
                            oninput="updateReceiver(${r.id}, 'company', this.value)">
                        <input 
                            type="text" 
                            class="form-input" 
                            style="font-size: 0.85rem;"
                            placeholder="Yetkili Kişi"
                            value="${escapeHtml(r.person || '')}"
                            oninput="updateReceiver(${r.id}, 'person', this.value)">
                        <input 
                            type="text" 
                            class="form-input" 
                            style="font-size: 0.85rem;"
                            placeholder="Telefon"
                            value="${escapeHtml(r.phone || '')}"
                            oninput="updateReceiver(${r.id}, 'phone', this.value)">
                        <input 
                            type="text" 
                            class="form-input" 
                            style="font-size: 0.85rem;"
                            placeholder="Adres (Sokak/Cadde)"
                            value="${escapeHtml(r.street || '')}"
                            oninput="updateReceiver(${r.id}, 'street', this.value)">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <input 
                                type="text" 
                                class="form-input" 
                                style="font-size: 0.85rem;"
                                placeholder="İlçe"
                                value="${escapeHtml(r.district || '')}"
                                oninput="updateReceiver(${r.id}, 'district', this.value)">
                            <input 
                                type="text" 
                                class="form-input" 
                                style="font-size: 0.85rem;"
                                placeholder="Şehir"
                                value="${escapeHtml(r.city || '')}"
                                oninput="updateReceiver(${r.id}, 'city', this.value)">
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function generateMultiReceiverLabels() {
            if (state.receivers.length === 0) {
                showToast(currentLang === 'tr' ? 'Önce alıcı ekleyin!' : 'Add receivers first!', 'warning');
                return;
            }
            
            // Boş firma adı kontrolü
            const emptyReceivers = state.receivers.filter(r => !r.company || !r.company.trim());
            if (emptyReceivers.length > 0) {
                showToast('Tüm alıcıların firma adı doldurulmalı!', 'warning');
                return;
            }
            
            // Store original receiver values
            const originalReceiver = {
                company: document.getElementById('receiverCompany').value,
                person: document.getElementById('receiverPerson').value,
                phone: document.getElementById('receiverPhone').value,
                street: document.getElementById('receiverStreet').value,
                district: document.getElementById('receiverDistrict').value,
                city: document.getElementById('receiverCity').value
            };
            const originalPrefix = document.getElementById('codePrefix').value;
            
            const printArea = document.getElementById('printArea');
            printArea.innerHTML = '';
            
            let totalPages = 0;
            
            // Generate labels for each receiver
            state.receivers.forEach((receiver, rIndex) => {
                // Set receiver info to form fields
                document.getElementById('receiverCompany').value = receiver.company || '';
                document.getElementById('receiverPerson').value = receiver.person || '';
                document.getElementById('receiverPhone').value = receiver.phone || '';
                document.getElementById('receiverStreet').value = receiver.street || '';
                document.getElementById('receiverDistrict').value = receiver.district || '';
                document.getElementById('receiverCity').value = receiver.city || '';
                
                // Generate auto prefix for this receiver
                generateAutoPrefix();
                
                // Generate labels (but don't clear printArea)
                generateLabels(false);
                totalPages += state.products.reduce((sum, p) => sum + p.count, 0);
            });
            
            // Restore original
            document.getElementById('receiverCompany').value = originalReceiver.company;
            document.getElementById('receiverPerson').value = originalReceiver.person;
            document.getElementById('receiverPhone').value = originalReceiver.phone;
            document.getElementById('receiverStreet').value = originalReceiver.street;
            document.getElementById('receiverDistrict').value = originalReceiver.district;
            document.getElementById('receiverCity').value = originalReceiver.city;
            document.getElementById('codePrefix').value = originalPrefix;
            
            closeModal('multiReceiverModal');
            showToast(`${state.receivers.length} alıcı için ${totalPages} etiket oluşturuldu!`, 'success');
        }
        
        // Internal label generation helper (for multi-receiver)
        function generateLabelsInternal(clearPrintArea = true) {
            generateLabels(clearPrintArea);
        }
    </script>
</body>
</html>
